<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wedding Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <!-- Dependencies: Lodash & SunEditor -->
    <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/suneditor@latest/dist/css/suneditor.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/suneditor@latest/dist/suneditor.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/suneditor@latest/src/lang/ko.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');

        body {
            background: #171a21;
            color: #c7d5e0;
            font-family: 'Noto Sans KR', sans-serif;
            overflow: hidden;
        }

        /* Theme */
        .card {
            background: #1b2838;
            border: 1px solid #2a475e;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }

        .header {
            background: linear-gradient(90deg, #2a475e, #1b2838);
            padding: 15px;
            border-bottom: 3px solid #171a21;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .input {
            background: #0e141b;
            border: 1px solid #45556c;
            color: #fff;
            padding: 8px 12px;
            font-size: 13px;
            width: 100%;
            transition: 0.2s;
            border-radius: 2px;
        }

        .input:focus {
            border-color: #66c0f4;
            background: #19222d;
            outline: none;
            box-shadow: 0 0 5px rgba(102, 192, 244, 0.4);
        }

        .label {
            color: #5bcaff;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            margin-bottom: 4px;
            display: block;
            letter-spacing: 0.5px;
        }

        .btn-blue {
            background: linear-gradient(to bottom, #47bfff 5%, #1a44c2 95%);
            color: #fff;
            padding: 10px 24px;
            font-size: 13px;
            font-weight: bold;
            border-radius: 2px;
            transition: 0.2s;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.4);
        }

        .btn-blue:hover {
            background: linear-gradient(to bottom, #66c0f4 5%, #1a44c2 95%);
            transform: translateY(-1px);
        }

        .btn-gray {
            background: #3d4450;
            color: #fff;
            padding: 8px 16px;
            font-size: 12px;
            border-radius: 2px;
        }

        .btn-gray:hover {
            background: #4b5260;
        }

        /* SunEditor Custom Styling */
        .sun-editor {
            border: 1px solid #2a475e !important;
            background: #1b2838 !important;
        }

        .sun-editor .se-toolbar {
            background-color: #1b2838 !important;
            outline: 1px solid #2a475e !important;
        }

        .sun-editor .se-resizing-bar {
            background-color: #1b2838 !important;
            border-top: 1px solid #2a475e !important;
        }

        .sun-editor-editable {
            background-color: #12151a !important;
            color: #fff !important;
        }

        .sun-editor .se-btn-module-border {
            border: 1px solid #2a475e !important;
        }

        .sun-editor .se-btn-list.default_value {
            background-color: #2a475e !important;
        }

        .sidebar {
            width: 260px;
            background: #17141f;
            border-right: 1px solid #2a475e;
            display: flex;
            flex-direction: column;
        }

        .nav-item {
            padding: 12px 20px;
            color: #8f98a0;
            font-size: 13px;
            cursor: pointer;
            transition: 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
            border-left: 3px solid transparent;
        }

        .nav-item:hover {
            color: #fff;
            background: rgba(255, 255, 255, 0.05);
        }

        .nav-item.active {
            background: linear-gradient(90deg, #2a475e, transparent);
            border-left-color: #66c0f4;
            color: #fff;
        }

        /* Draggable List */
        .drag-item {
            background: #16202d;
            padding: 10px;
            margin-bottom: 8px;
            border: 1px solid #2a475e;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: grab;
            transition: 0.2s;
        }

        .drag-item:active {
            cursor: grabbing;
            border-color: #66c0f4;
            background: #1b2838;
        }

        .drag-handle {
            color: #66c0f4;
            font-size: 18px;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #171a21;
        }

        ::-webkit-scrollbar-thumb {
            background: #3d4450;
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #4b5260;
        }

        [x-cloak] {
            display: none !important;
        }
    </style>
</head>

<body x-data="admin()" x-init="init()" class="h-screen flex">

    <!-- ë¡œê·¸ì¸ ì˜¤ë²„ë ˆì´ -->
    <div x-show="!auth" class="fixed inset-0 z-50 bg-[#171a21] flex items-center justify-center">
        <div class="card w-96 p-8 text-center animate__animated animate__fadeIn">
            <h1 class="text-2xl text-[#66c0f4] font-bold mb-4 tracking-widest">ì›¨ë”© ê´€ë¦¬ì</h1>
            <input type="password" x-model="pass" @keyup.enter="login"
                class="input text-center text-lg tracking-[0.3em] mb-4" placeholder="ë¹„ë°€ë²ˆí˜¸">
            <button @click="login" class="btn-blue w-full">ì½˜ì†” ì ‘ì†</button>
        </div>
    </div>

    <!-- ì‚¬ì´ë“œë°” -->
    <aside x-show="auth" x-cloak class="sidebar shrink-0">
        <div class="p-5 border-b border-[#2a475e]">
            <h2 class="text-white font-bold text-lg">ê²°í˜¼ì‹ í”„ë¡œì íŠ¸</h2>
            <div class="text-xs text-[#66c0f4]">ë¹Œë“œ Ver.<span x-text="data.version || '0.9.0'"></span></div>
        </div>
        <nav class="flex-1 overflow-y-auto py-2">
            <template x-for="t in tabs" :key="t.id">
                <div class="nav-item" :class="tab === t.id ? 'active' : ''" @click="tab = t.id">
                    <span x-text="t.icon"></span>
                    <span x-text="t.name"></span>
                </div>
            </template>
            <div class="nav-item border-t border-white/5 mt-2 pt-2" :class="tab === 'preview' ? 'active' : ''"
                @click="tab = 'preview'">
                <span>ğŸ“±</span>
                <span>ì‚¬ì´íŠ¸ ì‹œë®¬ë ˆì´ì…˜ (Preview)</span>
            </div>
        </nav>
        <div class="p-4 border-t border-[#2a475e] space-y-2">
            <button @click="saveLocal" class="btn-gray w-full text-[10px]">ì„ì‹œ ì €ì¥ (ë¡œì»¬)</button>
            <button @click="publishGithub" class="btn-blue w-full font-bold">ì„œë²„ì— ì ìš© (ë°°í¬)</button>
        </div>
    </aside>

    <!-- Main Content -->
    <main x-show="auth" x-cloak class="flex-1 overflow-y-auto bg-[#1b2838] relative">
        <div class="max-w-4xl mx-auto p-12 space-y-8 pb-32">

            <!-- HEADER -->
            <div class="flex justify-between items-end border-b border-[#3d4450] pb-4">
                <div>
                    <h1 class="text-3xl text-white font-light" x-text="tabs.find(t=>t.id===tab).name"></h1>
                    <p class="text-xs text-gray-500 mt-1">ëª¨ë°”ì¼ ì´ˆëŒ€ì¥ì˜ ë°ì´í„°ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.</p>
                </div>
                <div class="text-right">
                    <div class="text-xs text-[#66c0f4]">í˜„ì¬ IP: <span x-text="ip"></span></div>
                </div>
            </div>

            <!-- TAB: SECTIONS (Drag & Drop) -->
            <div x-show="tab === 'sections'" class="space-y-4">
                <p class="text-sm text-gray-400">Drag to reorder sections. Uncheck 'Visible' to hide from menu. Check
                    'Folded' to collapse by default.</p>

                <div class="space-y-2">
                    <template x-for="(s, idx) in sortedSections" :key="s.id">
                        <div class="drag-item group" draggable="true" @dragstart="dragStart($event, idx)"
                            @dragover.prevent @drop="drop($event, idx)">
                            <div class="drag-handle cursor-move opacity-50 group-hover:opacity-100">â˜°</div>
                            <div class="flex-1 font-bold text-white"><span x-text="idx+1"></span>. <span
                                    x-text="s.title"></span></div>
                            <div class="flex gap-4 text-xs">
                                <label class="flex items-center gap-1 cursor-pointer"><input type="checkbox"
                                        x-model="s.isVisible"> ë…¸ì¶œ</label>
                                <label class="flex items-center gap-1 cursor-pointer"><input type="checkbox"
                                        x-model="s.isFolded"> ê¸°ë³¸ ì ‘ê¸°(Folded)</label>
                            </div>
                        </div>
                    </template>
                </div>
            </div>

            <!-- TAB: IDENTITY -->
            <div x-show="tab === 'identity'" class="grid grid-cols-2 gap-8">
                <!-- Groom -->
                <div class="space-y-4">
                    <h3 class="text-blue-400 font-bold border-b border-[#3d4450] pb-2">ì‹ ë‘</h3>
                    <div class="grid grid-cols-2 gap-2">
                        <div><label class="label">ì´ë¦„</label><input x-model="data.groom.name" class="input"></div>
                        <div><label class="label">ê´€ê³„</label>
                            <select x-model="data.groom.rank" class="input">
                                <option>ì¥ë‚¨</option>
                                <option>ì°¨ë‚¨</option>
                                <option>ì‚¼ë‚¨</option>
                                <option>ì‚¬ë‚¨</option>
                                <option>ì™¸ë™</option>
                            </select>
                        </div>
                    </div>
                    <div><label class="label">ì—°ë½ì²˜</label><input x-model="data.groom.phone" class="input"></div>
                    <div class="grid grid-cols-2 gap-2">
                        <div><label class="label">ì€í–‰</label><input x-model="data.groom.bank" class="input"></div>
                        <div><label class="label">ê³„ì¢Œë²ˆí˜¸</label><input x-model="data.groom.account" class="input"></div>
                    </div>

                    <div class="p-4 bg-[#12151a] border border-[#2a475e] rounded space-y-3">
                        <label class="label text-gray-400">ë¶€ëª¨ë‹˜ ì •ë³´</label>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="space-y-2">
                                <p class="text-[10px] text-blue-400 font-bold">ì•„ë²„ì§€</p>
                                <input x-model="data.groom.parents.father" placeholder="ì„±í•¨" class="input">
                                <input x-model="data.groom.parents.fPhone" placeholder="ì—°ë½ì²˜" class="input">
                                <input x-model="data.groom.parents.fBank" placeholder="ì€í–‰" class="input">
                                <input x-model="data.groom.parents.fAccount" placeholder="ê³„ì¢Œë²ˆí˜¸" class="input">
                            </div>
                            <div class="space-y-2">
                                <p class="text-[10px] text-blue-400 font-bold">ì–´ë¨¸ë‹ˆ</p>
                                <input x-model="data.groom.parents.mother" placeholder="ì„±í•¨" class="input">
                                <input x-model="data.groom.parents.mPhone" placeholder="ì—°ë½ì²˜" class="input">
                                <input x-model="data.groom.parents.mBank" placeholder="ì€í–‰" class="input">
                                <input x-model="data.groom.parents.mAccount" placeholder="ê³„ì¢Œë²ˆí˜¸" class="input">
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Bride -->
                <div class="space-y-4">
                    <h3 class="text-pink-400 font-bold border-b border-[#3d4450] pb-2">ì‹ ë¶€</h3>
                    <div class="grid grid-cols-2 gap-2">
                        <div><label class="label">ì´ë¦„</label><input x-model="data.bride.name" class="input"></div>
                        <div><label class="label">ê´€ê³„</label>
                            <select x-model="data.bride.rank" class="input">
                                <option>ì¥ë…€</option>
                                <option>ì°¨ë…€</option>
                                <option>ì‚¼ë…€</option>
                                <option>ì‚¬ë…€</option>
                                <option>ì™¸ë™</option>
                            </select>
                        </div>
                    </div>
                    <div><label class="label">ì—°ë½ì²˜</label><input x-model="data.bride.phone" class="input"></div>
                    <div class="grid grid-cols-2 gap-2">
                        <div><label class="label">ì€í–‰</label><input x-model="data.bride.bank" class="input"></div>
                        <div><label class="label">ê³„ì¢Œë²ˆí˜¸</label><input x-model="data.bride.account" class="input"></div>
                    </div>

                    <div class="p-4 bg-[#12151a] border border-[#2a475e] rounded space-y-3">
                        <label class="label text-gray-400">ë¶€ëª¨ë‹˜ ì •ë³´</label>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="space-y-2">
                                <p class="text-[10px] text-pink-400 font-bold">ì•„ë²„ì§€</p>
                                <input x-model="data.bride.parents.father" placeholder="ì„±í•¨" class="input">
                                <input x-model="data.bride.parents.fPhone" placeholder="ì—°ë½ì²˜" class="input">
                                <input x-model="data.bride.parents.fBank" placeholder="ì€í–‰" class="input">
                                <input x-model="data.bride.parents.fAccount" placeholder="ê³„ì¢Œë²ˆí˜¸" class="input">
                            </div>
                            <div class="space-y-2">
                                <p class="text-[10px] text-pink-400 font-bold">ì–´ë¨¸ë‹ˆ</p>
                                <input x-model="data.bride.parents.mother" placeholder="ì„±í•¨" class="input">
                                <input x-model="data.bride.parents.mPhone" placeholder="ì—°ë½ì²˜" class="input">
                                <input x-model="data.bride.parents.mBank" placeholder="ì€í–‰" class="input">
                                <input x-model="data.bride.parents.mAccount" placeholder="ê³„ì¢Œë²ˆí˜¸" class="input">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TAB: CONTENT (Advanced Rich Text) -->
            <div x-show="tab === 'content'" class="space-y-8">
                <div class="space-y-2">
                    <label class="label text-[#66c0f4]">ë©”ì¸ ìƒë‹¨ ë¬¸êµ¬ (Hero Overlay)</label>
                    <div id="editor-mainOverlay"></div>
                </div>
                <div class="space-y-2">
                    <label class="label text-[#66c0f4]">ì¸ì‚¬ë§ ë³¸ë¬¸ (Main Message)</label>
                    <div id="editor-mainMessage"></div>
                    <p class="text-xs text-gray-500">ì •ë ¬, í°íŠ¸ ìƒ‰ìƒ, ì´ë¯¸ì§€ ë“±ì„ ììœ ë¡­ê²Œ í¸ì§‘í•˜ì„¸ìš”.</p>
                </div>
                <div class="space-y-2">
                    <label class="label text-[#66c0f4]">ì˜¤ì‹œëŠ” ê¸¸ ì•ˆë‚´ (Venue Guide)</label>
                    <div id="editor-venueGuide"></div>
                </div>
            </div>

            <!-- TAB: PREVIEW (Simulation) -->
            <div x-show="tab === 'preview'" class="space-y-8 animate__animated animate__fadeIn">
                <div class="flex flex-col items-center">
                    <div
                        class="w-full max-w-[375px] bg-white text-gray-800 rounded-[3rem] shadow-[0_0_60px_rgba(0,0,0,0.5)] border-[8px] border-[#2a475e] overflow-hidden relative">
                        <!-- Top Speaker Notch Simulation -->
                        <div class="absolute top-0 left-1/2 -translate-x-1/2 w-32 h-6 bg-[#2a475e] rounded-b-2xl z-20">
                        </div>

                        <div class="h-[667px] overflow-y-auto scrollbar-hide bg-[#fffcfc] sun-editor-common text-center"
                            id="simulation-container">
                            <!-- Hero Simulation -->
                            <div class="relative w-full overflow-hidden bg-[#fffcfc]">
                                <img :src="data.images.main" @click="lightbox = data.images.main"
                                    class="w-full h-auto object-cover block shadow-inner min-h-[200px]">
                                <div
                                    class="absolute inset-0 flex flex-col items-center justify-center p-8 bg-black/5 pointer-events-none">
                                    <div class="eng-font text-white text-3xl mb-2 drop-shadow-lg sun-editor-common"
                                        style="text-align: center" x-html="data.text.mainOverlay"></div>
                                    <div class="w-12 h-[1px] bg-white/40"></div>
                                </div>
                            </div>

                            <!-- Message Simulation -->
                            <div class="p-8 text-center space-y-6">
                                <div class="text-sm leading-relaxed lux-font text-gray-600 sun-editor-common"
                                    :style="`font-size: ${data.theme.style.fontSize}; line-height: ${data.theme.style.lineHeight}; letter-spacing: ${data.theme.style.letterSpacing}; text-align: ${data.theme.style.textAlign}`"
                                    x-html="data.text.mainMessage"></div>

                                <div class="w-full flex justify-center py-6">
                                    <div class="grid grid-cols-[1fr_auto_1fr] items-center gap-4 text-center">
                                        <!-- Groom -->
                                        <div class="flex flex-col items-center">
                                            <div class="text-[10px] text-gray-400 mb-2 lux-font">
                                                <span x-text="data.groom.parents.father"></span>Â·<span
                                                    x-text="data.groom.parents.mother"></span><span class="">ì˜</span>
                                                <span x-text="data.groom.rank"></span>
                                            </div>
                                            <div class="flex flex-col items-center">
                                                <span class="text-sm text-blue-600 font-bold lux-font mb-1">ì‹ ë‘</span>
                                                <h1 class="text-xl tracking-widest font-light lux-font"
                                                    x-text="data.groom.name"></h1>
                                            </div>
                                        </div>
                                        <div class="lux-font text-pink-200 self-end pb-1">&</div>
                                        <!-- Bride -->
                                        <div class="flex flex-col items-center">
                                            <div class="text-[10px] text-gray-400 mb-2 lux-font">
                                                <span x-text="data.bride.parents.father"></span>Â·<span
                                                    x-text="data.bride.parents.mother"></span><span class="">ì˜</span>
                                                <span x-text="data.bride.rank"></span>
                                            </div>
                                            <div class="flex flex-col items-center">
                                                <span class="text-sm text-pink-500 font-bold lux-font mb-1">ì‹ ë¶€</span>
                                                <h1 class="text-xl tracking-widest font-light lux-font"
                                                    x-text="data.bride.name"></h1>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Venue Simulation -->
                            <div class="p-8 border-t border-gray-50 text-left">
                                <div class="text-center mb-4">
                                    <div class="font-bold text-sm text-gray-700" x-text="data.config.venue.name"></div>
                                    <div class="text-[10px] text-gray-400" x-text="data.config.venue.address"></div>
                                </div>
                                <div id="map-simulation" class="w-full h-40 bg-gray-100 rounded mb-4"
                                    x-init="$nextTick(() => initSimulationMap())"></div>
                                <h3 class="lux-font text-sm font-bold text-gray-700 mb-4 text-center">ì˜¤ì‹œëŠ” ê¸¸</h3>
                                <div class="p-8 bg-[#fff9f9] rounded-2xl text-xs leading-relaxed text-gray-600 sun-editor-common border border-pink-50/50 shadow-sm"
                                    x-html="data.config.venue.guideText"></div>
                            </div>
                        </div>
                    </div>
                    <p class="mt-4 text-xs text-gray-500 italic">â€» ì‹¤ì œ ëª¨ë°”ì¼ í™”ë©´ì„ ì‹œë®¬ë ˆì´ì…˜í•œ ì˜ˆì‹œì…ë‹ˆë‹¤.</p>
                </div>
            </div>
            <!-- TAB: VISUALS (Uploads) -->
            <div x-show="tab === 'visuals'" class="space-y-8">
                <!-- Main Image -->
                <div class="p-4 bg-[#12151a] rounded border border-[#2a475e]">
                    <label class="steam-label">ë©”ì¸ ëŒ€í‘œ ì´ë¯¸ì§€</label>
                    <div class="flex gap-4 items-center">
                        <div class="w-24 h-24 bg-cover bg-center rounded border border-gray-600"
                            :style="`background-image: url(${data.images.main})`"></div>
                        <div class="flex-1 space-y-2">
                            <input type="text" x-model="data.images.main" class="steam-input" placeholder="ì´ë¯¸ì§€ URL">
                            <button class="btn-gray" @click="triggerUpload('main')">ğŸ“ íŒŒì¼ ì—…ë¡œë“œ</button>
                            <input type="file" id="file-main" class="hidden" @change="handleFile($event, 'main')">
                        </div>
                    </div>
                </div>

                <!-- Gallery -->
                <div class="space-y-4">
                    <div class="flex justify-between">
                        <label class="steam-label">ê°¤ëŸ¬ë¦¬ (ìµœëŒ€ 30ê°œ)</label>
                        <button class="text-xs text-[#66c0f4]" @click="data.images.gallery.push('')">+ ìŠ¬ë¡¯ ì¶”ê°€</button>
                    </div>
                    <div class="grid grid-cols-5 gap-2">
                        <template x-for="(img, idx) in data.images.gallery" :key="idx">
                            <div class="relative group aspect-square">
                                <div class="w-full h-full bg-cover bg-center rounded border border-gray-600"
                                    :style="`background-image: url(${img || 'about:blank'})`"></div>
                                <div
                                    class="absolute inset-0 bg-black/80 hidden group-hover:flex flex-col items-center justify-center p-1 gap-1">
                                    <input x-model="data.images.gallery[idx]" class="steam-input text-[8px] h-6">
                                    <button class="text-red-400 text-xs"
                                        @click="data.images.gallery.splice(idx, 1)">ì‚­ì œ</button>
                                </div>
                            </div>
                        </template>
                        <div @click="triggerSimpleUpload('gallery')"
                            class="border-2 border-dashed border-gray-600 rounded flex items-center justify-center cursor-pointer hover:border-[#66c0f4] text-gray-500 text-xs">
                            + ì—…ë¡œë“œ
                        </div>
                        <input type="file" id="file-gallery" class="hidden" @change="handleFile($event, 'gallery')">
                    </div>
                </div>

                <!-- BGM -->
                <div class="p-4 bg-[#12151a] rounded border border-[#2a475e] space-y-4">
                    <label class="steam-label">ë°°ê²½ìŒì•… (MP3)</label>
                    <div class="grid grid-cols-1 gap-2">
                        <template x-for="(song, idx) in data.media.bgm" :key="idx">
                            <div class="flex gap-2">
                                <input x-model="data.media.bgm[idx]" class="steam-input">
                                <button @click="data.media.bgm.splice(idx, 1)"
                                    class="text-red-400 hover:bg-red-900/20 px-2 rounded">âœ•</button>
                            </div>
                        </template>
                    </div>
                    <div class="flex gap-2">
                        <button class="btn-gray flex-1" @click="data.media.bgm.push('')">+ URL ì¶”ê°€</button>
                        <button class="btn-blue flex-1" @click="triggerSimpleUpload('bgm')">ğŸ“ íŒŒì¼ ì—…ë¡œë“œ</button>
                        <input type="file" id="file-bgm" class="hidden" @change="handleFile($event, 'bgm')">
                    </div>
                </div>

                <input type="color" x-model="data.theme.color" class="h-10 w-full bg-transparent">
            </div>

            <!-- Typography Sync -->
            <div class="p-6 bg-[#12151a] rounded border border-[#66c0f4]/30 space-y-6">
                <h3 class="text-sm font-bold text-[#66c0f4] flex items-center gap-2">
                    <span>ğŸ–‹ï¸</span> íƒ€ì´í¬ê·¸ë˜í”¼ (ë³¸ë¬¸ ìŠ¤íƒ€ì¼)
                </h3>
                <div class="grid grid-cols-2 gap-6">
                    <div class="space-y-2">
                        <label class="label">ê¸€ê¼´ í¬ê¸° (<span x-text="data.theme.style.fontSize"></span>)</label>
                        <input type="range" min="10" max="24" step="1" x-model="data.theme.style.fontSize"
                            @input="data.theme.style.fontSize = $event.target.value + 'px'"
                            class="w-full accent-[#66c0f4]">
                    </div>
                    <div class="space-y-2">
                        <label class="label">ì¤„ ê°„ê²© (<span x-text="data.theme.style.lineHeight"></span>)</label>
                        <input type="range" min="1.0" max="2.5" step="0.1" x-model="data.theme.style.lineHeight"
                            class="w-full accent-[#66c0f4]">
                    </div>
                    <div class="space-y-2">
                        <label class="label">ê¸€ì ìê°„ (<span x-text="data.theme.style.letterSpacing"></span>)</label>
                        <input type="range" min="-2" max="5" step="0.5" x-model="data.theme.style.letterSpacing"
                            @input="data.theme.style.letterSpacing = $event.target.value + 'px'"
                            class="w-full accent-[#66c0f4]">
                    </div>
                    <div class="space-y-2">
                        <label class="label">ì •ë ¬ ë°©ì‹</label>
                        <select x-model="data.theme.style.textAlign" class="input">
                            <option value="left">ì™¼ìª½ ì •ë ¬</option>
                            <option value="center">ê°€ìš´ë° ì •ë ¬</option>
                            <option value="right">ì˜¤ë¥¸ìª½ ì •ë ¬</option>
                            <option value="justify">ì–‘ìª½ ì •ë ¬</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB: LOGISTICS -->
        <div x-show="tab === 'logistics'" class="space-y-8">
            <div class="grid grid-cols-2 gap-8">
                <div class="space-y-2">
                    <label class="steam-label">ì˜ˆì‹ ì¼ì‹œ</label>
                    <input type="datetime-local" x-model="data.config.weddingDate" class="steam-input">
                </div>
                <div class="space-y-2">
                    <label class="steam-label">ì˜ˆì‹ì¥ ì´ë¦„</label>
                    <input x-model="data.config.venue.name" class="steam-input">
                </div>
            </div>

            <div class="space-y-2">
                <label class="steam-label">ì˜ˆì‹ì¥ ì£¼ì†Œ</label>
                <div class="flex gap-2">
                    <input x-model="data.config.venue.address" class="steam-input" readonly>
                    <button class="btn-gray whitespace-nowrap" @click="searchAddr">ğŸ” ì£¼ì†Œ ê²€ìƒ‰</button>
                </div>
            </div>

            <div class="space-y-4 pt-4 border-t border-[#3d4450]">
                <div class="flex justify-between items-center">
                    <label class="steam-label">ì§€ë„ ë‹¤ìš´ë¡œë“œìš© ì´ë¯¸ì§€</label>
                    <button class="btn-gray text-[10px]" @click="triggerUpload('mapImg')">ğŸ“ ì—…ë¡œë“œ</button>
                </div>
                <input type="file" id="file-mapImg" class="hidden" @change="handleFile($event, 'mapImg')">
                <input x-model="data.config.venue.mapImage" placeholder="ì§€ë„ ì´ë¯¸ì§€ URL (ì—…ë¡œë“œ ì‹œ ìë™ ì…ë ¥)" class="steam-input">
            </div>

            <div class="p-4 bg-[#12151a] rounded space-y-4">
                <label class="steam-label">ì§€ë„/ê¸¸ì°¾ê¸° ë§í¬</label>
                <div class="grid grid-cols-2 gap-4">
                    <input x-model="data.config.venue.mapLinks.naver" placeholder="ë„¤ì´ë²„ ì§€ë„ URL" class="steam-input">
                    <input x-model="data.config.venue.mapLinks.kakao" placeholder="ì¹´ì¹´ì˜¤ ë§µ URL" class="steam-input">
                    <input x-model="data.config.venue.mapLinks.tmap" placeholder="í‹°ë§µ URL" class="steam-input">
                    <input x-model="data.config.venue.mapLinks.google" placeholder="êµ¬ê¸€ ì§€ë„ URL" class="steam-input">
                </div>
            </div>
        </div>

        <!-- TAB: DATA MANAGEMENT -->
        <div x-show="tab === 'data_mgmt'" class="space-y-6">
            <div class="flex gap-4 mb-4">
                <button @click="loadExternalData" class="btn-blue text-xs">ğŸ”„ ë°ì´í„° ìƒˆë¡œê³ ì¹¨</button>
            </div>

            <!-- Guestbook -->
            <div class="card p-6 rounded-lg">
                <h3 class="text-[#66c0f4] font-bold mb-4 flex items-center gap-2">ğŸ“ ë°©ëª…ë¡ ë©”ì‹œì§€ (<span
                        x-text="bbs.length"></span>)</h3>
                <div class="space-y-2 max-h-[300px] overflow-y-auto pr-2">
                    <template x-for="(b, idx) in bbs" :key="idx">
                        <div
                            class="p-3 bg-[#0e141b] border border-[#2a475e] rounded flex justify-between items-center group">
                            <div class="flex-1">
                                <div class="text-sm font-bold text-white" x-text="b.name"></div>
                                <div class="text-xs text-gray-400 mt-1" x-text="b.message"></div>
                                <div class="text-[9px] text-gray-600 mt-1" x-text="b.date"></div>
                            </div>
                            <button @click="deleteItem('bbs', idx)"
                                class="btn-gray text-[10px] text-red-500 hover:bg-red-900/20">ì‚­ì œ</button>
                        </div>
                    </template>
                </div>
            </div>

            <!-- RSVP -->
            <div class="card p-6 rounded-lg">
                <h3 class="text-pink-400 font-bold mb-4 flex items-center gap-2">ğŸ“‹ ì°¸ì„ì ëª…ë‹¨ (<span
                        x-text="joins.length"></span>)</h3>
                <div class="space-y-2 max-h-[300px] overflow-y-auto pr-2">
                    <template x-for="(j, idx) in joins" :key="idx">
                        <div
                            class="p-3 bg-[#0e141b] border border-[#2a475e] rounded flex justify-between items-center group">
                            <div class="flex-1">
                                <div class="text-sm font-bold text-white"><span x-text="j.name"></span> (<span
                                        x-text="j.side === 'groom' ? 'ì‹ ë‘ì¸¡' : 'ì‹ ë¶€ì¸¡'"></span>)</div>
                                <div class="text-xs text-gray-400 mt-1">ì¸ì›: <span x-text="j.count"></span>ëª… / ì‹ì‚¬:
                                    <span x-text="j.meal ? 'ì˜ˆ' : 'ì•„ë‹ˆì˜¤'"></span>
                                </div>
                            </div>
                            <button @click="deleteItem('joins', idx)"
                                class="btn-gray text-[10px] text-red-500 hover:bg-red-900/20">ì‚­ì œ</button>
                        </div>
                    </template>
                </div>
            </div>
        </div>

        <!-- TAB: SETTINGS & SECRETS -->
        <div x-show="tab === 'settings'" class="space-y-6">
            <div class="p-4 border border-red-900 bg-red-900/10 rounded">
                <div class="flex justify-between items-center mb-2">
                    <label class="steam-label text-red-400">GITHUB í† í° (í•„ìˆ˜)</label>
                    <button @click="showTokenGuide = true" class="text-[10px] text-blue-400 underline">í† í° ë°œê¸‰ ë°©ë²•
                        ë³´ê¸°</button>
                </div>
                <input type="password" x-model="data.config.secrets.githubToken"
                    @input="localStorage.setItem('ghToken', $event.target.value)" class="steam-input"
                    placeholder="ghp_...">
                <p class="text-[10px] text-gray-500 mt-2">â€» íŒŒì¼ì„ ìˆ˜ì •í•˜ê±°ë‚˜ ì—…ë¡œë“œí•˜ë ¤ë©´ ì´ í† í°ì´ ë°˜ë“œì‹œ í•„ìš”í•©ë‹ˆë‹¤.</p>
            </div>
            <div class="grid grid-cols-2 gap-6">
                <div><label class="steam-label">ì¹´ì¹´ì˜¤ API í‚¤ (JavaScript)</label><input
                        x-model="data.config.secrets.kakaoApiKey" class="steam-input"></div>
                <div><label class="steam-label">ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸</label><input x-model="data.config.secrets.adminPassword"
                        class="steam-input" placeholder="ë¹„ë°€ë²ˆí˜¸ ë³€ê²½">
                </div>
            </div>

            <!-- OG Images -->
            <div class="space-y-4 pt-4 border-t border-[#3d4450]">
                <label class="steam-label">ê³µìœ ìš© ë©”íƒ€ ë°ì´í„° (OG Image)</label>
                <div class="grid grid-cols-2 gap-2">
                    <input x-model="data.images.og.kakao" placeholder="ì¹´ì¹´ì˜¤í†¡ ê³µìœ  ì´ë¯¸ì§€" class="steam-input">
                    <input x-model="data.images.og.facebook" placeholder="í˜ì´ìŠ¤ë¶ ê³µìœ  ì´ë¯¸ì§€" class="steam-input">
                    <input x-model="data.images.og.insta" placeholder="ì¸ìŠ¤íƒ€ê·¸ë¨ ê³µìœ  ì´ë¯¸ì§€" class="steam-input">
                    <input x-model="data.images.og.x" placeholder="X(íŠ¸ìœ„í„°) ê³µìœ  ì´ë¯¸ì§€" class="steam-input">
                </div>
            </div>

            <!-- Kakao Implementation Guide -->
            <div class="p-6 bg-blue-900/10 border border-blue-900/50 rounded-lg space-y-4">
                <h3 class="text-blue-400 font-bold flex items-center gap-2">ğŸ“ Kakao API ì„¤ì • ê°€ì´ë“œ</h3>
                <div class="text-xs text-gray-400 space-y-3 leading-relaxed">
                    <div class="p-3 bg-black/40 rounded">
                        <p class="text-white font-bold mb-1">1. ì¹´ì¹´ì˜¤ ê°œë°œì ì½˜ì†” ì ‘ì†</p>
                        <p><a href="https://developers.kakao.com/console/app" target="_blank"
                                class="text-blue-400 underline">ì¹´ì¹´ì˜¤ ë””ë²¨ë¡œí¼ìŠ¤</a>ì—ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ìƒì„±í•˜ì„¸ìš”.</p>
                    </div>
                    <div class="p-3 bg-black/40 rounded">
                        <p class="text-white font-bold mb-1">2. í”Œë«í¼ ë“±ë¡ (ì¤‘ìš”)</p>
                        <p><b>[ë‚´ ì• í”Œë¦¬ì¼€ì´ì…˜] > [í”Œë«í¼] > [Web]</b>ì—ì„œ ì•„ë˜ ë„ë©”ì¸ì„ ë“±ë¡í•´ì•¼ ê¸°ëŠ¥ì´ ë™ì‘í•©ë‹ˆë‹¤:</p>
                        <code class="block mt-1 text-[#66c0f4]">https://highhighcouple.github.io</code>
                    </div>
                    <div class="p-3 bg-black/40 rounded">
                        <p class="text-white font-bold mb-1">3. í‚¤ ì…ë ¥</p>
                        <p><b>[ì•± í‚¤]</b> ë©”ë‰´ì—ì„œ <b class="text-white">JavaScript í‚¤</b>ë¥¼ ë³µì‚¬í•˜ì—¬ ìœ„ 'ì¹´ì¹´ì˜¤ API í‚¤' ë€ì— ì…ë ¥í•˜ì„¸ìš”.</p>
                    </div>
                </div>
            </div>

            <!-- Update Log -->
            <div class="space-y-4 pt-6 border-t border-[#3d4450]">
                <div class="flex justify-between items-center">
                    <label class="steam-label text-gray-400">ì—…ë°ì´íŠ¸ ê¸°ë¡ (Update Log)</label>
                    <button
                        @click="data.updates.push({version: '', date: new Date().toISOString().split('T')[0], notes: ''})"
                        class="text-[10px] text-[#66c0f4]">+ ê¸°ë¡ ì¶”ê°€</button>
                </div>
                <div class="space-y-2">
                    <template x-for="(upd, idx) in data.updates" :key="idx">
                        <div class="flex gap-2 items-start">
                            <input x-model="upd.version" placeholder="Ver" class="input w-20">
                            <input x-model="upd.date" type="date" class="input w-36">
                            <input x-model="upd.notes" placeholder="ë³€ê²½ ë‚´ìš©" class="input flex-1">
                            <button @click="data.updates.splice(idx, 1)" class="text-red-400 p-2">âœ•</button>
                        </div>
                    </template>
                </div>
            </div>
        </div>

        </div>
    </main>

    <script>
        function admin() {
            return {
                auth: false, pass: '', tab: 'sections', ip: 'Loading...',
                dragSrc: null, showTokenGuide: false,
                tabs: [
                    { id: 'sections', name: 'í˜ì´ì§€ êµ¬ì„± (Sections)', icon: 'â˜°' },
                    { id: 'identity', name: 'ì´ˆëŒ€ ì¸ì ì‚¬í•­ (Names)', icon: 'ğŸ‘¤' },
                    { id: 'content', name: 'ì´ˆëŒ€ì¥ ë¬¸êµ¬ (Text)', icon: 'ğŸ“' },
                    { id: 'visuals', name: 'ë””ìì¸ ì„¤ì • (Visuals)', icon: 'ğŸ¨' },
                    { id: 'logistics', name: 'ì˜¤ì‹œëŠ” ê¸¸ (Location)', icon: 'ğŸ“' },
                    { id: 'data_mgmt', name: 'ë°©ëª…ë¡ ë° ì°¸ì„ì—¬ë¶€ (Data)', icon: 'ğŸ“‚' },
                    { id: 'settings', name: 'ê³ ê¸‰ ì„¤ì • (Settings)', icon: 'âš™ï¸' },
                ],
                bbs: [], joins: [],
                effects: [
                    { val: 'petals', icon: 'ğŸŒ¸', label: 'ë²šê½ƒ' }, { val: 'snow', icon: 'â„ï¸', label: 'ëˆˆ' },
                    { val: 'leaves', icon: 'ğŸ‚', label: 'ë‹¨í’' }, { val: 'stars', icon: 'âœ¨', label: 'ë³„ë¹›' },
                    { val: 'rain', icon: 'ğŸ’§', label: 'ë¹—ë°©ìš¸' }, { val: 'dandelion', icon: 'ğŸŒ¼', label: 'ë¯¼ë“¤ë ˆ' },
                    { val: 'butterfly', icon: 'ğŸ¦‹', label: 'ë‚˜ë¹„' }, { val: 'dragonfly', icon: 'ğŸŒ¥ï¸', label: 'ì ìë¦¬' },
                    { val: 'dove', icon: 'ğŸ•Šï¸', label: 'ë¹„ë‘˜ê¸°' }
                ],
                data: {
                    config: { venue: { mapLinks: {}, navLinks: {} }, secrets: {} },
                    groom: { parents: {} }, bride: { parents: {} },
                    images: { gallery: [], og: {} },
                    text: {}, media: { bgm: [] },
                    theme: {},
                    sections: []
                },
                defaultSections: [
                    { id: 'names', title: 'ì²­ì²©ì¥ ìƒë‹¨(Names)', isVisible: true, isFolded: false, order: 1 },
                    { id: 'calendar', title: 'ê²°í˜¼ì‹ ë‚ (Calendar)', isVisible: true, isFolded: false, order: 2 },
                    { id: 'youtube', title: 'ì˜ìƒ(Video)', isVisible: true, isFolded: false, order: 3 },
                    { id: 'gallery', title: 'ì‚¬ì§„ ì•¨ë²”(Gallery)', isVisible: true, isFolded: false, order: 4 },
                    { id: 'phone', title: 'ì—°ë½ì²˜(Contact)', isVisible: true, isFolded: true, order: 5 },
                    { id: 'accounts', title: 'ë§ˆìŒ ì „í•˜ì‹¤ ê³³(Accounts)', isVisible: true, isFolded: true, order: 6 },
                    { id: 'location', title: 'ì˜¤ì‹œëŠ” ê¸¸(Location)', isVisible: true, isFolded: false, order: 7 },
                    { id: 'guestbook', title: 'ë°©ëª…ë¡(Guestbook)', isVisible: true, isFolded: false, order: 8 },
                    { id: 'rsvp', title: 'ì°¸ì„ì—¬ë¶€(RSVP)', isVisible: true, isFolded: false, order: 9 },
                    { id: 'share', title: 'ê³µìœ (Share)', isVisible: true, isFolded: false, order: 10 }
                ],

                async init() {
                    fetch('https://api.ipify.org?format=json').then(r => r.json()).then(d => this.ip = d.ip);
                    const saved = localStorage.getItem('wedding_v2_data');
                    if (saved) this.data = JSON.parse(saved);
                    else {
                        try {
                            const r = await fetch('data.json');
                            if (r.ok) {
                                this.data = await r.json();
                                // Clean up navigation if exists
                                this.data.sections = this.data.sections.filter(s => s.id !== 'navigation' && s.id !== 'navlinks' && s.id !== 'maplinks');
                                // Ensure location section title is correct
                                const loc = this.data.sections.find(s => s.id === 'location');
                                if (loc) loc.title = 'ì˜¤ì‹œëŠ” ê¸¸(Location)';
                            }
                        } catch (e) { }
                    }
                    if (!this.data.sections || !this.data.sections.length) this.data.sections = this.defaultSections;
                    if (!this.data.media) this.data.media = { bgm: [] };
                    if (!this.data.media.bgm) this.data.media.bgm = [];

                    // Token Sync Logic
                    const localToken = localStorage.getItem('ghToken');
                    const dataToken = this.data.config.secrets.githubToken;

                    if (dataToken) {
                        // Priority 1: Token in data.json
                        localStorage.setItem('ghToken', dataToken);
                    } else if (localToken) {
                        // Priority 2: Token in localStorage
                        this.data.config.secrets.githubToken = localToken;
                    }

                    this.loadExternalData();

                    // Initialize SunEditor
                    this.$nextTick(() => {
                        this.initSunEditor();
                    });

                    // Map Simulator Watcher
                    this.$watch('data.config.venue.address', () => {
                        this.initSimulationMap();
                    });
                },

                initSunEditor() {
                    const buttonList = [
                        ['undo', 'redo'],
                        ['font', 'fontSize', 'formatBlock'],
                        ['bold', 'underline', 'italic', 'strike', 'subscript', 'superscript'],
                        ['fontColor', 'hiliteColor'],
                        ['removeFormat'],
                        ['outdent', 'indent'],
                        ['align', 'horizontalRule', 'list', 'lineHeight'],
                        ['link', 'image', 'video'],
                        ['fullScreen', 'showBlocks', 'codeView'],
                        ['preview', 'print']
                    ];

                    const editors = [
                        { id: 'editor-mainOverlay', key: 'data.text.mainOverlay' },
                        { id: 'editor-mainMessage', key: 'data.text.mainMessage' },
                        { id: 'editor-venueGuide', key: 'data.config.venue.guideText' }
                    ];

                    editors.forEach(ed => {
                        const container = document.getElementById(ed.id);
                        if (!container) return;

                        // Clear existing content to prevent double menu
                        container.innerHTML = '';

                        const editor = SUNEDITOR.create(ed.id, {
                            lang: SUNEDITOR_LANG['ko'],
                            buttonList: buttonList,
                            width: '100%',
                            height: ed.id === 'editor-venueGuide' ? '300px' : 'auto',
                            minHeight: '200px',
                            stickyToolbar: 0,
                            font: ['Nanum Myeongjo', 'Gowun Batang', 'Noto Sans KR', 'Arial', 'tahoma', 'Courier New,courier'],
                            fontSize: [8, 10, 12, 14, 16, 18, 20, 24, 28, 36],
                            placeholder: 'ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”...'
                        });

                        // Set Initial Content
                        const initial = _.get(this, ed.key) || '';
                        editor.setContents(initial);

                        // Sync to Alpine
                        editor.onChange = (content) => {
                            _.set(this, ed.key, content);
                        };

                        // Store editor instance for manual sync
                        if (!this._editors) this._editors = {};
                        this._editors[ed.key] = editor;
                    });
                },

                syncEditors() {
                    if (!this._editors) return;
                    Object.keys(this._editors).forEach(key => {
                        const content = this._editors[key].getContents();
                        _.set(this, key, content);
                    });
                },

                async loadExternalData() {
                    try {
                        const r1 = await fetch('bbs.json'); if (r1.ok) this.bbs = await r1.json();
                        const r2 = await fetch('join.json'); if (r2.ok) this.joins = await r2.json();
                    } catch (e) { }
                },

                async deleteItem(type, idx) {
                    if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ì„œë²„ì— ì¦‰ì‹œ ë°˜ì˜ë©ë‹ˆë‹¤)')) return;

                    const token = this.data.config.secrets.githubToken;
                    if (!token) return alert('GitHub í† í°ì´ í•„ìš”í•©ë‹ˆë‹¤.');

                    const list = type === 'bbs' ? [...this.bbs] : [...this.joins];
                    list.splice(idx, 1);
                    const filename = type === 'bbs' ? 'bbs.json' : 'join.json';

                    const content = btoa(unescape(encodeURIComponent(JSON.stringify(list, null, 2))));
                    try {
                        const r = await fetch(`https://api.github.com/repos/highhighcouple/Wedding_Invitation/contents/${filename}`, {
                            headers: { 'Authorization': `token ${token}` }
                        });
                        const d = await r.json();
                        const sha = d.sha;

                        const res = await fetch(`https://api.github.com/repos/highhighcouple/Wedding_Invitation/contents/${filename}`, {
                            method: 'PUT',
                            headers: { 'Authorization': `token ${token}` },
                            body: JSON.stringify({ message: `Delete entry from ${filename}`, content, sha })
                        });
                        if (res.ok) {
                            if (type === 'bbs') this.bbs = list; else this.joins = list;
                            alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                        }
                    } catch (e) { alert('ì‚­ì œ ì‹¤íŒ¨'); }
                },

                login() {
                    if (this.pass === 'admin1234!' || (this.data.config.secrets && this.pass === this.data.config.secrets.adminPassword)) {
                        this.auth = true;
                        if (this.data.config.secrets.githubToken) localStorage.setItem('ghToken', this.data.config.secrets.githubToken);
                    }
                    else alert('ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.');
                },

                get sortedSections() {
                    return this.data.sections.sort((a, b) => a.order - b.order);
                },

                // Drag & Drop
                dragStart(e, idx) { this.dragSrc = idx; e.dataTransfer.effectAllowed = 'move'; },
                drop(e, idx) {
                    if (this.dragSrc !== idx) {
                        const list = this.sortedSections;
                        const item = list[this.dragSrc];
                        list.splice(this.dragSrc, 1);
                        list.splice(idx, 0, item);
                        // Re-assign order
                        list.forEach((s, i) => s.order = i);
                        this.data.sections = list;
                    }
                },

                // File Upload Logic
                triggerUpload(target) { document.getElementById('file-' + target).click(); },
                triggerSimpleUpload(target) { document.getElementById('file-' + target).click(); },

                async handleFile(e, target) {
                    const file = e.target.files[0];
                    if (!file) return;
                    if (!this.data.config.secrets.githubToken) return alert('GitHub Token required for upload');

                    const reader = new FileReader();
                    reader.onload = async (evt) => {
                        const content = evt.target.result.split(',')[1]; // base64
                        let folder = 'local/images/gallery';
                        if (target === 'main') folder = 'local/images/bg';
                        if (target === 'bgm') folder = 'local/bgm';
                        if (target === 'mapImg') folder = 'local/images/map';

                        const path = `${folder}/${Date.now()}_${file.name}`;

                        // PUT to GitHub
                        try {
                            const res = await fetch(`https://api.github.com/repos/highhighcouple/Wedding_Invitation/contents/${path}`, {
                                method: 'PUT',
                                headers: {
                                    'Authorization': `token ${this.data.config.secrets.githubToken}`
                                },
                                body: JSON.stringify({ message: `upload ${target} file`, content: content })
                            });
                            if (res.ok) {
                                const json = await res.json();
                                const url = json.content.download_url; // Raw URL

                                if (target === 'main') this.data.images.main = url;
                                else if (target === 'gallery') this.data.images.gallery.push(url);
                                else if (target === 'bgm') this.data.media.bgm.push(url);
                                else if (target === 'mapImg') this.data.config.venue.mapImage = url;

                                alert('ì—…ë¡œë“œ ì„±ê³µ: ' + path);

                                // Auto Publish on Upload for Instant Apply
                                this.publishGithub(true);
                            } else {
                                const err = await res.json();
                                alert('ì—…ë¡œë“œ ì‹¤íŒ¨: ' + err.message);
                            }
                        } catch (err) { alert('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜'); }
                    };
                    reader.readAsDataURL(file);
                },

                searchAddr() {
                    const self = this;
                    new daum.Postcode({
                        oncomplete: function (data) {
                            self.data.config.venue.address = data.address;
                            alert('ì£¼ì†Œê°€ ì…ë ¥ë˜ì—ˆìŠµë‹ˆë‹¤: ' + data.address);
                        }
                    }).open();
                },

                publishGithub(silent = false) {
                    this.syncEditors(); // ENSURE RICH TEXT SYNC

                    const token = this.data.config.secrets.githubToken;
                    if (!token) {
                        if (!silent) {
                            this.tab = 'settings';
                            alert('GitHub í† í°ì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆê¹Œ? ê³ ê¸‰ ì„¤ì • íƒ­ì—ì„œ í† í°ì„ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”.');
                        }
                        return;
                    }

                    if (!silent && !confirm('ì´ˆëŒ€ì¥ ë°ì´í„°ë¥¼ ì‹¤ì‹œê°„ ì„œë²„ì— ë°°í¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

                    // SANITIZE DATA: Remove secrets before publishing to avoid "Secret detected" errors
                    const cleanData = JSON.parse(JSON.stringify(this.data));
                    if (cleanData.config.secrets) {
                        cleanData.config.secrets.githubToken = "";
                        // kakaoApiKey is public for frontend use, keep it to allow map to work
                    }

                    const content = btoa(unescape(encodeURIComponent(JSON.stringify(cleanData, null, 2))));

                    // 1. Get current SHA to prevent conflicts
                    fetch(`https://api.github.com/repos/highhighcouple/Wedding_Invitation/contents/data.json`, {
                        headers: { 'Authorization': `token ${token}` }
                    })
                        .then(r => {
                            if (!r.ok) throw new Error('íŒŒì¼ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                            return r.json();
                        })
                        .then(d => {
                            const sha = d.sha;
                            // 2. PUT updated data
                            return fetch(`https://api.github.com/repos/highhighcouple/Wedding_Invitation/contents/data.json`, {
                                method: 'PUT',
                                headers: { 'Authorization': `token ${token}` },
                                body: JSON.stringify({ message: 'ì´ˆëŒ€ì¥ ë°ì´í„° ì—…ë°ì´íŠ¸ (Admin)', content, sha })
                            });
                        })
                        .then(r => {
                            if (r.ok) {
                                if (!silent) alert('ğŸ‰ ë°°í¬ê°€ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\në°©ê¸ˆ ìˆ˜ì •í•œ ë‚´ìš©ì´ ìˆ˜ ë¶„ ë‚´ì— ì‹¤ì œ ì‚¬ì´íŠ¸ì— ë°˜ì˜ë©ë‹ˆë‹¤.');
                                else console.log('Auto-apply: Successful');
                            } else {
                                return r.json().then(err => {
                                    throw new Error(err.message || 'ë°°í¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ');
                                });
                            }
                        })
                        .catch(err => {
                            if (!silent) alert('âŒ ë°°í¬ ì‹¤íŒ¨: ' + err.message);
                            console.error('Publish Error:', err);
                        });

                    localStorage.setItem('wedding_v2_data', JSON.stringify(this.data));
                },
                saveLocal() {
                    this.syncEditors(); // ENSURE RICH TEXT SYNC
                    localStorage.setItem('wedding_v2_data', JSON.stringify(this.data));
                    alert('ë¡œì»¬ì— ì„ì‹œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                },
                initSimulationMap() {
                    const key = this.data.config.secrets.kakaoApiKey || 'dacffa882aa3284870d06afa02bd5947';
                    const container = document.getElementById('map-simulation');
                    if (!container) return;

                    const runSearch = () => {
                        const geocoder = new kakao.maps.services.Geocoder();
                        const addr = this.data.config.venue.address;
                        if (!addr) return;

                        const drawMap = (y, x) => {
                            const coords = new kakao.maps.LatLng(y, x);
                            const options = { center: coords, level: 3 };
                            const map = new kakao.maps.Map(container, options);
                            new kakao.maps.Marker({ position: coords, map: map });
                            setTimeout(() => map.relayout(), 500);
                        };

                        geocoder.addressSearch(addr, (result, status) => {
                            if (status === kakao.maps.services.Status.OK) {
                                drawMap(result[0].y, result[0].x);
                            } else {
                                // Fallback: Mariage Square
                                drawMap(37.521503, 127.037492);
                            }
                        });
                    };

                    if (typeof kakao !== 'undefined' && kakao.maps && kakao.maps.services) {
                        runSearch();
                    } else {
                        const script = document.createElement('script');
                        script.src = `https://dapi.kakao.com/v2/maps/sdk.js?appkey=${key}&libraries=services&autoload=false`;
                        script.onload = () => {
                            kakao.maps.load(() => runSearch());
                        };
                        document.head.appendChild(script);
                    }
                }
            }
        }
    </script>
</body>

</html>