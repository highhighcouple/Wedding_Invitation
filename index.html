<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title x-data x-text="$store.weddingTitle || 'ëª¨ë°”ì¼ ì²­ì²©ì¥'"></title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Gowun+Batang:wght@400;700&family=Nanum+Myeongjo:wght@400;700&family=Noto+Serif+KR:wght@300;400;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
    <script type="text/javascript"
        src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=dacffa882aa3284870d06afa02bd5947&libraries=services&autoload=false"></script>
    <style>
        :root {
            --accent: #f2aebc;
            --text: #222;
            --bg: #ffffff;
        }

        body {
            font-family: 'Gowun Batang', serif;
            color: var(--text);
            background: var(--bg);
            overflow-x: hidden;
            scroll-behavior: smooth;
            font-size: 18px;
        }

        [x-cloak] {
            display: none !important;
        }

        .lux-font {
            font-family: 'Nanum Myeongjo', serif;
        }

        #effect-canvas {
            position: fixed;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: 50;
        }

        /* Optimized Accordion */
        .section-fold-content {
            display: grid;
            grid-template-rows: 0fr;
            transition: grid-template-rows 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
        }

        .section-fold-content.open {
            grid-template-rows: 1fr;
        }

        .section-fold-inner {
            min-height: 0;
        }

        /* Calendar Styling */
        .cal-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            text-align: center;
            border: 1px solid #f0f0f0;
        }

        .cal-cell {
            aspect-ratio: 1/1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            border: 0.5px solid #fafafa;
        }

        .cal-header {
            font-weight: bold;
            padding: 12px 0;
            background: #fdfdfd;
            font-size: 0.85rem;
        }

        .cal-sat {
            color: #3b82f6 !important;
        }

        .cal-sun {
            color: #ef4444 !important;
        }

        .cal-wedding {
            background: var(--accent);
            color: white !important;
            border-radius: 50%;
            width: 34px;
            height: 34px;
            margin: auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(242, 174, 188, 0.4);
        }

        [x-cloak] {
            display: none !important;
        }

        #interactive-canvas {
            position: fixed;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: 60;
        }

        .reveal {
            opacity: 0;
            transform: translateY(30px);
            transition: all 1.2s cubic-bezier(0.22, 1, 0.36, 1);
        }

        .reveal.active {
            opacity: 1;
            transform: translateY(0);
        }

        .section-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.8s ease-in-out;
        }

        .section-content.open {
            max-height: 4000px;
        }

        .intro-layer {
            background: #fff;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .bgm-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            border: 1px solid #eee;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            cursor: pointer;
            transition: transform 0.3s;
        }

        .bgm-btn:hover {
            transform: scale(1.1);
        }

        .btn-action {
            @apply px-4 py-2 border border-gray-100 rounded-full text-[11px] bg-white/80 backdrop-blur hover:bg-gray-50 transition-all shadow-sm;
        }

        /* Calendar Grid */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
            text-align: center;
        }

        .day-cell {
            width: 2.5rem;
            height: 2.5rem;
            display: flex;
            items-center;
            justify-content: center;
            font-size: 0.875rem;
            border-radius: 9999px;
            transition: all 0.3s;
        }

        /* Floating Star Dust */
        .star-dust {
            position: absolute;
            background: white;
            border-radius: 50%;
            pointer-events: none;
            animation: floatUp 4s infinite linear;
        }

        @keyframes floatUp {
            0% {
                transform: translateY(0) scale(1);
                opacity: 0.8;
            }

            100% {
                transform: translateY(-150px) scale(0);
                opacity: 0;
            }
        }

        /* Section Separator */
        .section-sep {
            height: 1px;
            background: linear-gradient(to right, transparent, #eee, transparent);
            margin: 1rem 0;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            tracking: 0.1em;
            color: #1a1a1a;
            position: relative;
            display: inline-block;
        }

        .modal-dim {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.85);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(8px);
        }

        pre {
            font-family: 'Gowun Batang', serif;
        }
    </style>
</head>

<body x-data="weddingApp()" x-init="init()">

    <canvas id="effect-canvas"></canvas>

    <!-- BGM Controller -->
    <div class="fixed top-6 right-6 z-[200]">
        <button @click="toggleBgm()"
            class="w-14 h-14 bg-white/90 backdrop-blur rounded-full border border-gray-100 shadow-xl flex items-center justify-center text-2xl hover:scale-105 transition-transform">
            <span x-text="bgmPlaying ? 'â¸' : 'ğŸµ'"></span>
        </button>
        <audio id="bgm-player" loop src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3"></audio>
    </div>

    <!-- 1. Hero Section -->
    <section class="min-h-screen relative flex flex-col">
        <div class="relative w-full h-[75vh] overflow-hidden">
            <img :src="data.mainImage" class="w-full h-full object-cover">
            <div class="absolute inset-0 flex flex-col p-10 text-white"
                :class="{'justify-start': data.overlayPos === 'top', 'justify-center items-center': data.overlayPos === 'middle', 'justify-end': data.overlayPos === 'bottom'}">
                <h1 class="lux-font italic text-5xl md:text-7xl drop-shadow-2xl animate__animated animate__fadeInDown"
                    x-text="data.overlayText"></h1>
            </div>
        </div>
        <div class="flex-1 bg-white py-20 px-10 text-center">
            <pre class="text-2xl md:text-3xl leading-relaxed whitespace-pre-wrap font-bold text-gray-800 animate__animated animate__fadeInUp"
                x-text="data.mainMessage"></pre>
        </div>
    </section>

    <!-- Dynamic Content -->
    <main class="max-w-3xl mx-auto px-6 pb-32">
        <template x-for="section in sortedSections" :key="section.id">
            <div x-show="section.isVisible" class="mb-2">
                <div class="section-sep"></div>
                <!-- Accordion Header -->
                <div @click="toggleFold(section)" class="flex justify-between items-center py-5 cursor-pointer group">
                    <h2 class="section-title" x-text="`[ ${section.title} ]`"></h2>
                    <span class="text-2xl text-gray-400 group-hover:text-pink-400 transition-colors"
                        x-text="section.isFolded ? 'â–¼' : 'â–²'"></span>
                </div>

                <div class="section-fold-content" :class="!section.isFolded ? 'open' : ''">
                    <div class="section-fold-inner space-y-10 pb-12">

                        <!-- 2. Names -->
                        <template x-if="section.id === 'names'">
                            <div
                                class="grid grid-cols-2 gap-10 text-center bg-gray-50/50 p-10 rounded-3xl border border-gray-50">
                                <div class="space-y-6">
                                    <p class="text-xs text-blue-400 font-bold tracking-widest uppercase">Groom</p>
                                    <h3 class="text-3xl font-bold" x-text="data.groom.name"></h3>
                                    <div class="text-sm text-gray-500 space-y-1">
                                        <p x-text="`${data.groom.father} Â· ${data.groom.mother}`"></p>
                                        <p class="italic text-gray-400" x-text="'ì˜ ' + data.groom.rank"></p>
                                    </div>
                                </div>
                                <div class="space-y-6 border-l border-gray-100">
                                    <p class="text-xs text-pink-400 font-bold tracking-widest uppercase">Bride</p>
                                    <h3 class="text-3xl font-bold" x-text="data.bride.name"></h3>
                                    <div class="text-sm text-gray-500 space-y-1">
                                        <p x-text="`${data.bride.father} Â· ${data.bride.mother}`"></p>
                                        <p class="italic text-gray-400" x-text="'ì˜ ' + data.bride.rank"></p>
                                    </div>
                                </div>
                            </div>
                        </template>

                        <!-- 3. Calendar -->
                        <template x-if="section.id === 'calendar'">
                            <div class="bg-white border p-10 rounded-3xl shadow-sm space-y-10">
                                <h4 class="text-2xl font-bold text-center" x-text="getCalTitle()"></h4>
                                <div class="cal-grid">
                                    <template x-for="h in ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† ']">
                                        <div class="cal-header" :class="h==='ì¼'?'cal-sun':(h==='í† '?'cal-sat':'')"
                                            x-text="h"></div>
                                    </template>
                                    <template x-for="e in getCalStartDay()">
                                        <div></div>
                                    </template>
                                    <template x-for="d in getCalDays()">
                                        <div class="cal-cell">
                                            <div :class="isWeddingDay(d) ? 'cal-wedding' : (getCalDayNum(d)===0 ? 'cal-sun' : (getCalDayNum(d)===6 ? 'cal-sat' : ''))"
                                                x-text="d"></div>
                                        </div>
                                    </template>
                                </div>
                                <div class="text-center space-y-2">
                                    <p class="text-xs text-gray-400 font-bold tracking-[0.4em] uppercase">Wedding
                                        Countdown</p>
                                    <p class="text-4xl font-bold text-gray-800 font-mono tracking-tighter"
                                        x-text="timerText"></p>
                                </div>
                            </div>
                        </template>

                        <!-- 4. YouTube -->
                        <template x-if="section.id === 'youtube'">
                            <div class="relative aspect-video rounded-3xl overflow-hidden shadow-2xl group cursor-pointer"
                                @click="openYoutube()">
                                <img :src="`https://img.youtube.com/vi/${getYoutubeId()}/maxresdefault.jpg`"
                                    class="w-full h-full object-cover">
                                <div class="absolute inset-0 bg-black/40 flex items-center justify-center">
                                    <div
                                        class="w-24 h-24 bg-white/95 rounded-full flex items-center justify-center text-4xl shadow-xl group-hover:scale-110 transition-transform">
                                        â–¶</div>
                                </div>
                            </div>
                        </template>

                        <!-- 5. Gallery -->
                        <template x-if="section.id === 'gallery'">
                            <div class="space-y-8">
                                <div class="relative aspect-[4/5] rounded-3xl overflow-hidden shadow-2xl bg-gray-100">
                                    <template x-for="(img, i) in data.gallery" :key="i">
                                        <img :src="img"
                                            class="absolute inset-0 w-full h-full object-cover transition-opacity duration-1000"
                                            :class="galIdx === i ? 'opacity-100' : 'opacity-0'"
                                            @click="openGallery(img)">
                                    </template>
                                </div>
                                <div class="grid grid-cols-5 gap-3">
                                    <template x-for="(img, i) in data.gallery" :key="i">
                                        <div @click="galIdx = i"
                                            class="aspect-square cursor-pointer border-2 transition-all rounded-xl overflow-hidden"
                                            :class="galIdx === i ? 'border-pink-300 scale-95 shadow-lg' : 'border-transparent opacity-50'">
                                            <img :src="img" class="w-full h-full object-cover">
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </template>

                        <!-- 6. Phone -->
                        <template x-if="section.id === 'phone'">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                                <div class="bg-blue-50/20 p-8 rounded-3xl space-y-6">
                                    <p class="text-xs font-bold text-blue-400 uppercase tracking-widest">ì‹ ë‘ì¸¡</p>
                                    <template x-for="p in getGroomPhones()">
                                        <div
                                            class="flex justify-between items-center bg-white p-5 rounded-2xl border border-blue-50 shadow-sm">
                                            <div class="flex flex-col">
                                                <span class="font-bold text-lg" x-text="p.label"></span>
                                                <span class="text-xs text-gray-400 font-mono" x-text="p.val"></span>
                                            </div>
                                            <a :href="`tel:${p.val}`"
                                                class="w-12 h-12 bg-blue-500 text-white rounded-full flex items-center justify-center text-xl shadow-lg">ğŸ“</a>
                                        </div>
                                    </template>
                                </div>
                                <div class="bg-pink-50/20 p-8 rounded-3xl space-y-6">
                                    <p class="text-xs font-bold text-pink-400 uppercase tracking-widest">ì‹ ë¶€ì¸¡</p>
                                    <template x-for="p in getBridePhones()">
                                        <div
                                            class="flex justify-between items-center bg-white p-5 rounded-2xl border border-pink-50 shadow-sm">
                                            <div class="flex flex-col">
                                                <span class="font-bold text-lg" x-text="p.label"></span>
                                                <span class="text-xs text-gray-400 font-mono" x-text="p.val"></span>
                                            </div>
                                            <a :href="`tel:${p.val}`"
                                                class="w-12 h-12 bg-pink-500 text-white rounded-full flex items-center justify-center text-xl shadow-lg">ğŸ“</a>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </template>

                        <!-- 7. Accounts -->
                        <template x-if="section.id === 'accounts'">
                            <div class="space-y-8">
                                <div class="bg-gray-50/50 p-8 rounded-3xl space-y-6">
                                    <p class="text-xs font-bold text-gray-400 uppercase tracking-widest">ì‹ ë‘ì¸¡ ë§ˆìŒ ì „í•˜ì‹¤ ê³³
                                    </p>
                                    <template x-for="a in getGroomAccounts()">
                                        <div class="bg-white p-6 rounded-2xl border border-gray-100 space-y-3">
                                            <div class="flex justify-between text-sm">
                                                <span class="font-bold text-lg" x-text="a.label"></span>
                                                <span class="bg-gray-100 px-3 py-1 rounded-full text-xs font-bold"
                                                    x-text="a.bank"></span>
                                            </div>
                                            <div class="flex justify-between items-center">
                                                <span class="text-xl font-mono font-bold tracking-tight"
                                                    x-text="a.val"></span>
                                                <button @click="copy(a.val)"
                                                    class="text-xs bg-gray-800 text-white px-4 py-2 rounded-xl">ë³µì‚¬</button>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                                <div class="bg-pink-50/10 p-8 rounded-3xl space-y-6">
                                    <p class="text-xs font-bold text-pink-300 uppercase tracking-widest">ì‹ ë¶€ì¸¡ ë§ˆìŒ ì „í•˜ì‹¤ ê³³
                                    </p>
                                    <template x-for="a in getBrideAccounts()">
                                        <div class="bg-white p-6 rounded-2xl border border-pink-50 space-y-3">
                                            <div class="flex justify-between text-sm">
                                                <span class="font-bold text-lg" x-text="a.label"></span>
                                                <span
                                                    class="bg-pink-50 px-3 py-1 rounded-full text-xs font-bold text-pink-400"
                                                    x-text="a.bank"></span>
                                            </div>
                                            <div class="flex justify-between items-center">
                                                <span class="text-xl font-mono font-bold tracking-tight"
                                                    x-text="a.val"></span>
                                                <button @click="copy(a.val)"
                                                    class="text-xs bg-pink-400 text-white px-4 py-2 rounded-xl">ë³µì‚¬</button>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </template>

                        <!-- 8. Location -->
                        <template x-if="section.id === 'location'">
                            <div class="space-y-10">
                                <div class="text-center space-y-4">
                                    <h3 class="text-3xl font-bold" x-text="data.venue.name"></h3>
                                    <p class="text-gray-500 leading-relaxed" x-text="data.venue.address"></p>
                                    <div class="flex justify-center gap-8 py-2">
                                        <a :href="`tel:${data.venue.phone}`"
                                            class="text-sm font-bold border-b-2 border-pink-200 pb-1">ì˜ˆì‹ì¥ ì „í™”</a>
                                        <a :href="data.venue.homepage" target="_blank"
                                            class="text-sm font-bold border-b-2 border-pink-200 pb-1">í™ˆí˜ì´ì§€</a>
                                    </div>
                                </div>
                                <div id="map" class="rounded-3xl shadow-xl overflow-hidden border border-gray-100">
                                </div>
                                <div class="bg-white p-10 rounded-3xl border shadow-sm">
                                    <pre class="text-base leading-loose whitespace-pre-wrap text-gray-700"
                                        x-text="data.venue.guideText"></pre>
                                </div>
                            </div>
                        </template>

                        <!-- 11. Guestbook -->
                        <template x-if="section.id === 'guestbook'">
                            <div class="space-y-8">
                                <div class="space-y-4">
                                    <template x-for="g in data.guestbook.slice(0, 3)">
                                        <div
                                            class="p-8 bg-white border border-gray-100 rounded-3xl shadow-sm relative animate__animated animate__fadeIn">
                                            <div class="flex justify-between mb-3">
                                                <span class="text-sm font-bold text-pink-400" x-text="g.name"></span>
                                                <span class="text-[10px] text-gray-300 font-mono"
                                                    x-text="g.date"></span>
                                            </div>
                                            <p class="text-base text-gray-700 font-light leading-relaxed"
                                                x-text="g.content"></p>
                                        </div>
                                    </template>
                                </div>
                                <div class="grid grid-cols-2 gap-4">
                                    <button @click="showGuestbookModal = true"
                                        class="py-5 bg-gray-900 text-white rounded-2xl font-bold text-lg shadow-xl">ë©”ì‹œì§€
                                        ì‘ì„±</button>
                                    <button @click="showAllGuestbook = true"
                                        class="py-5 bg-white border border-gray-100 text-gray-400 rounded-2xl font-bold text-lg shadow-sm">ì „ì²´
                                        ë³´ê¸°</button>
                                </div>
                            </div>
                        </template>

                        <!-- 12. RSVP -->
                        <template x-if="section.id === 'rsvp'">
                            <div class="bg-gray-50 p-12 rounded-[3rem] text-center space-y-8 border border-gray-100">
                                <p class="text-base text-gray-500 leading-relaxed">ì°¸ì„í•´ì£¼ì‹œëŠ” ëª¨ë“  ë¶„ë“¤ê»˜<br>ì •ì„±ì„ ë‹¤í•´ ëŒ€ì ‘í•˜ê² ìŠµë‹ˆë‹¤.</p>
                                <button @click="showRsvpModal = true"
                                    class="w-full py-6 bg-pink-400 text-white rounded-2xl font-bold text-xl shadow-2xl shadow-pink-100 tracking-widest">ì°¸ì„
                                    ì—¬ë¶€ ì „ë‹¬í•˜ê¸°</button>
                            </div>
                        </template>

                        <!-- 13. Share -->
                        <template x-if="section.id === 'share'">
                            <div class="flex justify-center gap-8 py-10 flex-wrap">
                                <button @click="share('kakao')"
                                    class="w-16 h-16 bg-[#FEE500] rounded-full flex items-center justify-center shadow-lg text-2xl">ğŸ’¬</button>
                                <button @click="share('facebook')"
                                    class="w-16 h-16 bg-[#1877F2] text-white rounded-full flex items-center justify-center shadow-lg text-3xl font-black">f</button>
                                <button @click="share('x')"
                                    class="w-16 h-16 bg-black text-white rounded-full flex items-center justify-center shadow-lg text-xl">ğ•</button>
                                <button @click="copyLink()"
                                    class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center shadow-lg text-2xl">ğŸ”—</button>
                            </div>
                        </template>

                    </div>
                </div>
            </div>
        </template>
    </main>

    <footer class="py-32 text-center bg-gray-50/50 mt-10">
        <p class="text-gray-400 tracking-[0.8em] text-xs font-bold uppercase mb-6">Love & Eternal Bliss</p>
        <p class="text-gray-300 text-[11px] font-light">Copyright(c) Joe All Right Reserved</p>
    </footer>

    <!-- Modals -->
    <div x-show="showYoutube" x-transition.opacity class="modal-dim" @click="showYoutube = false">
        <div class="w-full max-w-4xl aspect-video px-6" @click.stop>
            <iframe :src="`https://www.youtube.com/embed/${getYoutubeId()}?autoplay=1`"
                class="w-full h-full rounded-[2rem] shadow-2xl" frameborder="0" allow="autoplay; encrypted-media"
                allowfullscreen></iframe>
        </div>
    </div>

    <div x-show="showGalModal" x-transition.opacity class="modal-dim" @click="showGalModal = false">
        <img :src="activeImg"
            class="max-w-[95%] max-h-[90vh] object-contain rounded-3xl shadow-2xl animate__animated animate__zoomIn">
    </div>

    <!-- RSVP Modal -->
    <div x-show="showRsvpModal" x-transition class="modal-dim z-[3000]" @click="showRsvpModal = false">
        <div class="bg-white w-[92%] max-w-md p-10 rounded-[2.5rem] space-y-8 max-h-[90vh] overflow-y-auto" @click.stop>
            <h3 class="text-3xl font-bold text-center">ì°¸ì„ ì—¬ë¶€</h3>
            <div class="flex gap-3">
                <button @click="rsvpSide = 'groom'" class="flex-1 py-4 rounded-2xl border-2 font-bold transition-all"
                    :class="rsvpSide === 'groom' ? 'bg-blue-50 border-blue-200 text-blue-600' : 'bg-white border-gray-100 text-gray-300'">ì‹ ë‘ì¸¡</button>
                <button @click="rsvpSide = 'bride'" class="flex-1 py-4 rounded-2xl border-2 font-bold transition-all"
                    :class="rsvpSide === 'bride' ? 'bg-pink-50 border-pink-200 text-pink-600' : 'bg-white border-gray-100 text-gray-300'">ì‹ ë¶€ì¸¡</button>
            </div>
            <div class="space-y-6">
                <div class="flex gap-4">
                    <label
                        class="flex-1 flex items-center justify-center border-2 p-5 rounded-2xl cursor-pointer transition-all"
                        :class="rsvpForm.attend ? 'bg-gray-800 text-white border-gray-800' : 'border-gray-100'">
                        <input type="radio" x-model="rsvpForm.attend" :value="true" class="hidden"> ì°¸ì„
                    </label>
                    <label
                        class="flex-1 flex items-center justify-center border-2 p-5 rounded-2xl cursor-pointer transition-all"
                        :class="!rsvpForm.attend ? 'bg-gray-800 text-white border-gray-800' : 'border-gray-100'">
                        <input type="radio" x-model="rsvpForm.attend" :value="false" class="hidden"> ë¶ˆì°¸
                    </label>
                </div>
                <input type="text" x-model="rsvpForm.name" placeholder="ì„±í•¨ ì…ë ¥"
                    class="w-full p-6 bg-gray-50 rounded-2xl outline-none focus:ring-2 ring-pink-100 text-lg">
                <input type="text" x-model="rsvpForm.phone" placeholder="010-0000-0000"
                    class="w-full p-6 bg-gray-50 rounded-2xl outline-none focus:ring-2 ring-pink-100 text-lg">

                <template x-if="rsvpForm.attend">
                    <div class="space-y-6 animate__animated animate__fadeIn">
                        <div class="flex gap-4">
                            <label
                                class="flex-1 flex items-center justify-center border-2 p-5 rounded-2xl cursor-pointer transition-all"
                                :class="rsvpForm.meal ? 'bg-gray-800 text-white border-gray-800' : 'border-gray-100'">
                                <input type="radio" x-model="rsvpForm.meal" :value="true" class="hidden"> ì‹ì‚¬ ì˜ˆì •
                            </label>
                            <label
                                class="flex-1 flex items-center justify-center border-2 p-5 rounded-2xl cursor-pointer transition-all"
                                :class="!rsvpForm.meal ? 'bg-gray-800 text-white border-gray-800' : 'border-gray-100'">
                                <input type="radio" x-model="rsvpForm.meal" :value="false" class="hidden"> ì‹ì‚¬ ë¯¸ì˜ˆì •
                            </label>
                        </div>
                        <div x-show="rsvpForm.meal"
                            class="flex items-center justify-between bg-gray-50 p-5 rounded-2xl">
                            <span class="text-sm font-bold text-gray-500 uppercase tracking-tighter">ë³¸ì¸ í¬í•¨ ì¸ì›</span>
                            <div class="flex items-center gap-4">
                                <button @click="rsvpForm.plusOnes = Math.max(1, rsvpForm.plusOnes-1)"
                                    class="w-10 h-10 bg-white rounded-full shadow-sm font-bold">-</button>
                                <span class="text-xl font-bold w-6 text-center" x-text="rsvpForm.plusOnes"></span>
                                <button @click="rsvpForm.plusOnes++"
                                    class="w-10 h-10 bg-white rounded-full shadow-sm font-bold">+</button>
                            </div>
                        </div>
                    </div>
                </template>
            </div>
            <button @click="submitRsvp()"
                class="w-full py-6 bg-pink-400 text-white rounded-2xl font-bold text-xl shadow-2xl shadow-pink-100">ì°¸ì„
                ì •ë³´ ì „ë‹¬</button>
        </div>
    </div>

    <!-- Guestbook Write Modal -->
    <div x-show="showGuestbookModal" x-transition class="modal-dim z-[3000]" @click="showGuestbookModal = false">
        <div class="bg-white w-[92%] max-w-md p-10 rounded-[2.5rem] space-y-6" @click.stop>
            <h3 class="text-2xl font-bold text-center">ì¶•í•˜ ë©”ì‹œì§€</h3>
            <input type="text" x-model="gbForm.name" placeholder="ì„±í•¨ì„ ì…ë ¥í•´ì£¼ì„¸ìš”." maxlength="20"
                class="w-full p-6 bg-gray-50 rounded-2xl outline-none text-lg">
            <textarea x-model="gbForm.content" placeholder="ì¶•ë³µì˜ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”. (ìµœëŒ€ 255ì)" maxlength="255" rows="5"
                class="w-full p-6 bg-gray-50 rounded-2xl outline-none resize-none text-lg"></textarea>
            <p class="text-[11px] text-gray-300 leading-relaxed">ì‘ì„±í•˜ì‹  ë‚´ìš©ì€ ê³µê°œë˜ë©°, ë¶€ì ì ˆí•œ ë‚´ìš©ì€ ê´€ë¦¬ìì— ì˜í•´ ì‚­ì œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            <button @click="submitGuestbook()"
                class="w-full py-6 bg-gray-900 text-white rounded-2xl font-bold text-xl">ë©”ì‹œì§€ ë“±ë¡</button>
        </div>
    </div>

    <script>
        function weddingApp() {
            return {
                isLoaded: false,
                bgmPlaying: false,
                galIdx: 0,
                timerText: '',
                showYoutube: false,
                showGalModal: false,
                showRsvpModal: false,
                showGuestbookModal: false,
                showAllGuestbook: false,
                activeImg: '',
                rsvpSide: 'groom',
                rsvpForm: { attend: true, name: '', phone: '', meal: true, plusOnes: 1 },
                gbForm: { name: '', content: '' },
                data: {},
                sortedSections: [],

                async init() {
                    const saved = localStorage.getItem('wedding_v2_data');
                    this.data = saved ? JSON.parse(saved) : this.getInitialState();
                    this.sortedSections = [...this.data.sections].sort((a, b) => a.order - b.order);

                    document.title = `Â§${this.data.groom.name}Â§ â™¥ Â§${this.data.bride.name}Â§ì˜ ëª¨ë°”ì¼ ì²­ì²©ì¥`;

                    this.initPetals();
                    this.initTimer();
                    this.initMap();
                    this.initReveal();

                    this.isLoaded = true;
                    // Gallery Loop
                    setInterval(() => { this.galIdx = (this.galIdx + 1) % this.data.gallery.length; }, 5000);
                },

                getInitialState() {
                    return {
                        mainImage: 'https://images.unsplash.com/photo-1511795409834-ef04bbd61622?q=80&w=2069',
                        overlayText: 'Wedding Invitation',
                        overlayPos: 'top',
                        mainMessage: 'ì¡°í˜„ìš° ê·¸ë¦¬ê³  ë¥˜í•˜ì˜\n\n2026ë…„ 05ì›” 02ì¼ í† ìš”ì¼ PM 13ì‹œ 00ë¶„\nê°•ë‚¨ ë§ˆë¦¬ì•„ì¥¬ ìŠ¤í€˜ì–´\n\nì˜ì›íˆ í•¨ê»˜í• \nì‚¬ë‘ì˜ ë§¹ì„¸\nê°™ì´ ì¶•ë³µí•´ì£¼ì„¸ìš”.',
                        weddingDate: '2026-05-02T13:00:00',
                        youtubeLink: 'https://youtu.be/UmdCDfXQ8wQ?si=IirtVYdyD2qBEybR',
                        groom: { name: 'ì¡°í˜„ìš°', father: 'ì¡°ë³µë˜', mother: 'ë‚˜ì„ í¬', rank: 'ì¥ë‚¨', phone: '010-3366-4848', acc: '040-086067-01-014', bank: 'ê¸°ì—…' },
                        bride: { name: 'ë¥˜í•˜ì˜', father: 'ë¥˜ë¯¼ì„', mother: 'ê³ ìš°í¬', rank: 'ì¥ë…€', phone: '010-6556-7525', acc: '926-54-7559-46', bank: 'êµ­ë¯¼' },
                        groomParents: { fPhone: '010-9090-0824', mPhone: '010-9877-0824', fAcc: '109-08-072450', fBank: 'ìš°ë¦¬', mAcc: '110-587-170868', mBank: 'ì‹ í•œ' },
                        brideParents: { fPhone: '010-5356-7558', mPhone: '010-9858-7551', fAcc: '302-5356-7558-41', fBank: 'ë†í˜‘', mAcc: '339-06-063092', mBank: 'ì‹ í•œ' },
                        gallery: [
                            'https://images.unsplash.com/photo-1583939003579-730e3918a45a?w=1000',
                            'https://images.unsplash.com/photo-1519225421980-715cb0215aed?w=1000',
                            'https://images.unsplash.com/photo-1519741497674-611481863552?w=1000',
                            'https://images.unsplash.com/photo-1520854221256-17451cc331bf?w=1000',
                            'https://images.unsplash.com/photo-1511285560929-80b456fea0bc?w=1000',
                            'https://images.unsplash.com/photo-1510076857177-7470076d4098?w=1000'
                        ],
                        venue: {
                            name: 'ë§ˆë¦¬ì•„ì¥¬ ìŠ¤í€˜ì–´',
                            address: 'ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ ë„ì‚°ëŒ€ë¡œ 318 SBíƒ€ì›Œ Gì¸µ',
                            phone: '02-541-5007',
                            homepage: 'http://www.mariagesquare.com/',
                            guideText: 'ì…”í‹€ìš´í–‰\n7í˜¸ì„ , ë¶„ë‹¹ì„  ê°•ë‚¨êµ¬ì²­ì—­ 3ë²ˆì¶œêµ¬ ì…”í‹€ë²„ìŠ¤ ì´ìš©\n\nì§€í•˜ì² \nê°•ë‚¨êµ¬ì²­ì—­ 3-1ë²ˆ ì¶œêµ¬ ë„ë³´ 600M'
                        },
                        sections: [
                            { id: 'names', title: 'Eternal Promise', isVisible: true, isFolded: false, order: 1 },
                            { id: 'calendar', title: 'The Day', isVisible: true, isFolded: false, order: 2 },
                            { id: 'youtube', title: 'Memory Film', isVisible: true, isFolded: true, order: 3 },
                            { id: 'gallery', title: 'Gallery', isVisible: true, isFolded: true, order: 4 },
                            { id: 'phone', title: 'Contact', isVisible: true, isFolded: true, order: 5 },
                            { id: 'accounts', title: 'Gift', isVisible: true, isFolded: true, order: 6 },
                            { id: 'location', title: 'Location', isVisible: true, isFolded: false, order: 7 },
                            { id: 'guestbook', title: 'Guestbook', isVisible: true, isFolded: true, order: 8 },
                            { id: 'rsvp', title: 'RSVP', isVisible: true, isFolded: false, order: 9 },
                            { id: 'share', title: 'Share', isVisible: true, isFolded: true, order: 10 }
                        ],
                        guestbook: [
                            { name: 'ì¡°í˜„ìš°', content: 'ë°©ë¬¸í•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤. í–‰ë³µí•˜ê²Œ ì˜ ì‚´ê² ìŠµë‹ˆë‹¤!', date: '2026.01.01' }
                        ]
                    };
                },

                toggleBgm() {
                    const audio = document.getElementById('bgm-player');
                    if (this.bgmPlaying) audio.pause();
                    else audio.play();
                    this.bgmPlaying = !this.bgmPlaying;
                },

                toggleFold(section) {
                    section.isFolded = !section.isFolded;
                },

                initPetals() {
                    const canvas = document.getElementById('effect-canvas');
                    const ctx = canvas.getContext('2d');
                    let petals = [];
                    const resize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };
                    window.addEventListener('resize', resize); resize();

                    class Petal {
                        constructor() {
                            this.x = Math.random() * canvas.width;
                            this.y = -20;
                            this.size = Math.random() * 10 + 5;
                            this.vX = Math.random() * 2 - 1;
                            this.vY = Math.random() * 1.5 + 1;
                            this.angle = Math.random() * 360;
                            this.vAngle = Math.random() * 2 - 1;
                            this.opacity = Math.random() * 0.5 + 0.2;
                        }
                        update() {
                            this.x += this.vX; this.y += this.vY; this.angle += this.vAngle;
                            if (this.y > canvas.height) this.y = -20;
                        }
                        draw() {
                            ctx.save();
                            ctx.translate(this.x, this.y);
                            ctx.rotate(this.angle * Math.PI / 180);
                            ctx.globalAlpha = this.opacity;
                            ctx.fillStyle = '#f2aebc';
                            ctx.beginPath();
                            ctx.ellipse(0, 0, this.size, this.size / 2, 0, 0, Math.PI * 2);
                            ctx.fill();
                            ctx.restore();
                        }
                    }

                    for (let i = 0; i < 35; i++) petals.push(new Petal());
                    const loop = () => {
                        ctx.clearRect(0, 0, canvas.width, canvas.height);
                        petals.forEach(p => { p.update(); p.draw(); });
                        requestAnimationFrame(loop);
                    };
                    loop();
                },

                initTimer() {
                    const update = () => {
                        const now = new Date();
                        const kstNow = new Date(now.getTime() + (now.getTimezoneOffset() * 60000) + (9 * 3600000));
                        const target = new Date(this.data.weddingDate);
                        const kstTarget = new Date(target.getTime() + (target.getTimezoneOffset() * 60000) + (9 * 3600000));
                        const diff = kstTarget - kstNow;
                        const prefix = diff >= 0 ? 'D-' : 'D+';
                        const abs = Math.abs(diff);
                        const d = Math.floor(abs / 86400000);
                        const h = String(Math.floor((abs % 86400000) / 3600000)).padStart(2, '0');
                        const m = String(Math.floor((abs % 3600000) / 60000)).padStart(2, '0');
                        const s = String(Math.floor((abs % 60000) / 1000)).padStart(2, '0');
                        this.timerText = `${prefix}${d} ${h}:${m}:${s}`;
                    };
                    update(); setInterval(update, 1000);
                },

                initMap() {
                    const load = () => {
                        if (typeof kakao === 'undefined') return setTimeout(load, 200);
                        kakao.maps.load(() => {
                            const mapContainer = document.getElementById('map');
                            if (!mapContainer) return;
                            const mapOption = { center: new kakao.maps.LatLng(37.5218, 127.0374), level: 3 };
                            const map = new kakao.maps.Map(mapContainer, mapOption);
                            const geocoder = new kakao.maps.services.Geocoder();
                            geocoder.addressSearch(this.data.venue.address, (result, status) => {
                                if (status === kakao.maps.services.Status.OK) {
                                    const coords = new kakao.maps.LatLng(result[0].y, result[0].x);
                                    new kakao.maps.Marker({ map: map, position: coords });
                                    map.setCenter(coords);
                                }
                            });
                        });
                    };
                    this.$nextTick(load);
                },

                initReveal() {
                    const obs = new IntersectionObserver(entries => {
                        entries.forEach(e => { if (e.isIntersecting) e.target.classList.add('active'); });
                    }, { threshold: 0.1 });
                    this.$nextTick(() => document.querySelectorAll('.reveal').forEach(el => obs.observe(el)));
                },

                getYoutubeId() {
                    const match = this.data.youtubeLink.match(/(?:youtu\.be\/|youtube\.com\/(?:v\/|u\/\w\/|embed\/|watch\?v=))([^#\&\?]*)/);
                    return (match && match[1].length === 11) ? match[1] : '';
                },
                openYoutube() { this.showYoutube = true; },
                openGallery(img) { this.activeImg = img; this.showGalModal = true; },
                copy(txt) { navigator.clipboard.writeText(txt); alert('í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.'); },
                copyLink() { navigator.clipboard.writeText(window.location.href); alert('í´ë¦½ë³´ë“œì— ì£¼ì†Œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.'); },

                getCalTitle() { const d = new Date(this.data.weddingDate); return `${d.getFullYear()} . ${d.getMonth() + 1}`; },
                getCalStartDay() { const d = new Date(this.data.weddingDate); return new Date(d.getFullYear(), d.getMonth(), 1).getDay(); },
                getCalDays() { const d = new Date(this.data.weddingDate); return new Date(d.getFullYear(), d.getMonth() + 1, 0).getDate(); },
                getCalDayNum(d) { const date = new Date(this.data.weddingDate); return new Date(date.getFullYear(), date.getMonth(), d).getDay(); },
                isWeddingDay(d) { return d === new Date(this.data.weddingDate).getDate(); },

                getGroomPhones() {
                    let res = [{ label: this.data.groom.name, val: this.data.groom.phone }];
                    if (this.data.groomParents.fPhone) res.push({ label: 'ë¶€ì¹œ ' + this.data.groom.father, val: this.data.groomParents.fPhone });
                    if (this.data.groomParents.mPhone) res.push({ label: 'ëª¨ì¹œ ' + this.data.groom.mother, val: this.data.groomParents.mPhone });
                    return res;
                },
                getBridePhones() {
                    let res = [{ label: this.data.bride.name, val: this.data.bride.phone }];
                    if (this.data.brideParents.fPhone) res.push({ label: 'ë¶€ì¹œ ' + this.data.bride.father, val: this.data.brideParents.fPhone });
                    if (this.data.brideParents.mPhone) res.push({ label: 'ëª¨ì¹œ ' + this.data.bride.mother, val: this.data.brideParents.mPhone });
                    return res;
                },
                getGroomAccounts() {
                    let res = [{ label: 'ì‹ ë‘ ' + this.data.groom.name, val: this.data.groom.acc, bank: this.data.groom.bank }];
                    if (this.data.groomParents.fAcc) res.push({ label: 'ë¶€ì¹œ ' + this.data.groom.father, val: this.data.groomParents.fAcc, bank: this.data.groomParents.fBank });
                    if (this.data.groomParents.mAcc) res.push({ label: 'ëª¨ì¹œ ' + this.data.groom.mother, val: this.data.groomParents.mAcc, bank: this.data.groomParents.mBank });
                    return res;
                },
                getBrideAccounts() {
                    let res = [{ label: 'ì‹ ë¶€ ' + this.data.bride.name, val: this.data.bride.acc, bank: this.data.bride.bank }];
                    if (this.data.brideParents.fAcc) res.push({ label: 'ë¶€ì¹œ ' + this.data.bride.father, val: this.data.brideParents.fAcc, bank: this.data.brideParents.fBank });
                    if (this.data.brideParents.mAcc) res.push({ label: 'ëª¨ì¹œ ' + this.data.bride.mother, val: this.data.brideParents.mAcc, bank: this.data.brideParents.mBank });
                    return res;
                },

                submitRsvp() {
                    if (!this.rsvpForm.name || !this.rsvpForm.phone) return alert('ì„±í•¨ê³¼ ì—°ë½ì²˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    const existing = JSON.parse(localStorage.getItem('rsvp_data') || '[]');
                    existing.push({ ...this.rsvpForm, side: this.rsvpSide, date: new Date().toLocaleString() });
                    localStorage.setItem('rsvp_data', JSON.stringify(existing));
                    alert('ì°¸ì„ ì—¬ë¶€ê°€ ì •ì„±ìŠ¤ëŸ½ê²Œ ì „ë‹¬ë˜ì—ˆìŠµë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤.');
                    this.showRsvpModal = false;
                },

                submitGuestbook() {
                    if (!this.gbForm.name || !this.gbForm.content) return alert('ì„±í•¨ê³¼ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    this.data.guestbook.unshift({ name: this.gbForm.name, content: this.gbForm.content, date: new Date().toLocaleDateString() });
                    localStorage.setItem('wedding_v2_data', JSON.stringify(this.data));
                    this.gbForm = { name: '', content: '' };
                    this.showGuestbookModal = false;
                    alert('ì¶•í•˜ ë©”ì‹œì§€ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
                },

                share(type) {
                    const url = window.location.href;
                    if (type === 'kakao') alert('ì¹´ì¹´ì˜¤í†¡ API ì—°ë™ í•„ìš”');
                    else if (type === 'facebook') window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`);
                    else if (type === 'x') window.open(`https://twitter.com/intent/tweet?url=${encodeURIComponent(url)}`);
                }
            };
        }
    </script>
</body>

</html>