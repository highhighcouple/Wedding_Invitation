
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title x-text="data.groom && data.bride ? `${data.groom.name} ‚ô• ${data.bride.name}Ïùò Î™®Î∞îÏùº Ï≤≠Ï≤©Ïû•` : 'Î™®Î∞îÏùº Ï≤≠Ï≤©Ïû•'"></title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script&family=Noto+Serif+KR:wght@200;400;700&family=Nanum+Myeongjo&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <style>
        :root { --main-bg: #ffffff; --text-color: #333333; --accent: #d4af37; }
        body { font-family: 'Noto Serif KR', serif; background-color: var(--main-bg); color: var(--text-color); overflow-x: hidden; scroll-behavior: smooth; }
        .font-cursive { font-family: 'Dancing Script', cursive; }
        [x-cloak] { display: none !important; }
        
        #interactive-canvas { position: fixed; top: 0; left: 0; pointer-events: none; z-index: 60; }
        .reveal { opacity: 0; transform: translateY(30px); transition: all 1.2s cubic-bezier(0.22, 1, 0.36, 1); }
        .reveal.active { opacity: 1; transform: translateY(0); }

        .section-content { max-height: 0; overflow: hidden; transition: max-height 0.8s ease-in-out; }
        .section-content.open { max-height: 4000px; }

        .intro-layer { background: #fff; z-index: 1000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .bgm-btn { width: 44px; height: 44px; border-radius: 50%; border: 1px solid #eee; display: flex; align-items: center; justify-content: center; background: white; box-shadow: 0 4px 12px rgba(0,0,0,0.05); cursor: pointer; transition: transform 0.3s; }
        .bgm-btn:hover { transform: scale(1.1); }

        .btn-action { @apply px-4 py-2 border border-gray-100 rounded-full text-[11px] bg-white/80 backdrop-blur hover:bg-gray-50 transition-all shadow-sm; }
        
        /* Calendar Grid */
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 0.5rem; text-align: center; }
        .day-cell { width: 2.5rem; height: 2.5rem; display: flex; items-center; justify-content: center; font-size: 0.875rem; border-radius: 9999px; transition: all 0.3s; }
        
        /* Floating Star Dust */
        .star-dust { position: absolute; background: white; border-radius: 50%; pointer-events: none; animation: floatUp 4s infinite linear; }
        @keyframes floatUp { 0% { transform: translateY(0) scale(1); opacity: 0.8; } 100% { transform: translateY(-150px) scale(0); opacity: 0; } }
    </style>
</head>
<body x-data="weddingApp()" x-init="init()" @mousemove="handleMouseMove($event)" @touchstart="handleTouchMove($event)">

    <canvas id="interactive-canvas"></canvas>

    <!-- Intro Layer -->
    <div x-show="showIntro" x-transition.opacity.duration.1000ms class="fixed inset-0 intro-layer" @click="closeIntro()" @wheel="closeIntro()">
        <div class="text-center space-y-10 animate__animated animate__fadeIn">
            <h2 class="font-cursive text-5xl text-gray-400">Our Special Day</h2>
            <div class="flex flex-col items-center">
                <div class="w-px h-24 bg-gradient-to-b from-gray-200 to-transparent animate-bounce"></div>
                <p class="mt-6 text-[10px] tracking-[0.6em] text-gray-400 uppercase">Scroll to Celebrate</p>
            </div>
        </div>
    </div>

    <!-- Header Navigation -->
    <header class="fixed top-0 left-0 right-0 z-50 p-6 flex justify-between items-center pointer-events-none">
        <div class="flex items-center gap-3 pointer-events-auto">
            <button @click="toggleBgm()" class="bgm-btn">
                <template x-if="!bgmPlaying"><span>‚ñ∂</span></template>
                <template x-if="bgmPlaying"><span class="animate-pulse text-rose-300">‚ô´</span></template>
            </button>
        </div>
        <div class="flex items-center gap-3 pointer-events-auto">
            <button @click="runTTS()" class="btn-action">TTS</button>
            <div class="relative" x-data="{ open: false }">
                <button @click="open = !open" class="btn-action flex items-center gap-2">
                    <span x-text="currentLang.flag"></span> <span x-text="currentLang.name"></span>
                </button>
                <div x-show="open" @click.away="open = false" x-cloak class="absolute right-0 mt-3 bg-white border border-gray-100 rounded-2xl shadow-2xl p-3 w-40 space-y-1">
                    <template x-for="lang in languages">
                        <button @click="changeLang(lang); open = false" class="w-full text-left px-4 py-2 text-xs hover:bg-rose-50 rounded-xl flex items-center gap-3 transition-colors">
                            <span x-text="lang.flag"></span> <span x-text="lang.name"></span>
                        </button>
                    </template>
                </div>
            </div>
        </div>
    </header>

    <main class="relative z-20" x-show="data.groom">
        <!-- Section 1: Hero -->
        <section class="h-screen relative flex items-center justify-center overflow-hidden">
            <img :src="data.mainImage" class="absolute inset-0 w-full h-full object-cover transition-transform duration-[30s] scale-110" style="filter: brightness(0.85);">
            <div class="absolute inset-0 bg-black/5"></div>
            <div class="relative z-10 text-center text-white space-y-8 px-6">
                <h1 class="font-cursive text-7xl md:text-9xl reveal animate__animated animate__fadeInDown" x-text="data.overlayText"></h1>
                <div class="space-y-3 reveal" style="transition-delay: 0.6s">
                    <p class="text-xl md:text-2xl font-light tracking-[0.3em]" x-text="`${data.groom.name} & ${data.bride.name}`"></p>
                    <p class="text-[10px] uppercase tracking-[0.6em] opacity-70" x-text="formatDateKST(data.weddingDate)"></p>
                </div>
            </div>
        </section>

        <!-- Dynamic Content Sections -->
        <template x-for="section in sortedSections" :key="section.id">
            <div x-show="section.isVisible" class="max-w-2xl mx-auto py-24 px-8 text-center reveal">
                
                <div @click="section.isFolded = !section.isFolded" class="cursor-pointer mb-12 inline-block">
                    <h2 class="text-[11px] tracking-[0.5em] text-gray-300 uppercase hover:text-rose-300 transition-colors" x-text="section.title"></h2>
                    <div class="w-8 h-px bg-gray-100 mx-auto mt-4"></div>
                </div>

                <div class="section-content" :class="!section.isFolded ? 'open' : ''">
                    
                    <!-- Main Text Section -->
                    <template x-if="section.id === 'mainText'">
                        <div class="py-12 space-y-8">
                            <pre class="whitespace-pre-wrap leading-loose text-gray-500 font-light text-base md:text-lg italic tracking-wide" x-text="data.mainText"></pre>
                        </div>
                    </template>

                    <!-- Profile Section -->
                    <template x-if="section.id === 'names'">
                        <div class="py-12 space-y-16">
                            <div class="grid md:grid-cols-2 gap-12 items-center">
                                <!-- Groom Side -->
                                <div class="space-y-6">
                                    <p class="text-[10px] text-rose-300 tracking-[0.4em] uppercase">The Groom</p>
                                    <h3 class="text-3xl font-bold tracking-tighter" x-text="data.groom.name"></h3>
                                    <div class="text-sm text-gray-400 space-y-1">
                                        <p><span x-text="data.groom.father"></span> ¬∑ <span x-text="data.groom.mother"></span>Ïùò <span x-text="data.groom.rank"></span></p>
                                    </div>
                                    <div class="flex justify-center gap-4 mt-6">
                                        <a :href="`tel:${data.groom.phone}`" class="w-10 h-10 flex items-center justify-center rounded-full border border-gray-100 text-gray-400 hover:text-rose-300 transition-colors shadow-sm bg-white">üìû</a>
                                    </div>
                                </div>
                                <!-- Bride Side -->
                                <div class="space-y-6">
                                    <p class="text-[10px] text-rose-300 tracking-[0.4em] uppercase">The Bride</p>
                                    <h3 class="text-3xl font-bold tracking-tighter" x-text="data.bride.name"></h3>
                                    <div class="text-sm text-gray-400 space-y-1">
                                        <p><span x-text="data.bride.father"></span> ¬∑ <span x-text="data.bride.mother"></span>Ïùò <span x-text="data.bride.rank"></span></p>
                                    </div>
                                    <div class="flex justify-center gap-4 mt-6">
                                        <a :href="`tel:${data.bride.phone}`" class="w-10 h-10 flex items-center justify-center rounded-full border border-gray-100 text-gray-400 hover:text-rose-300 transition-colors shadow-sm bg-white">üìû</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </template>

                    <!-- Calendar Section -->
                    <template x-if="section.id === 'calendar'">
                        <div class="py-12">
                            <div class="inline-block p-12 bg-white rounded-[3rem] border border-gray-100 shadow-2xl shadow-rose-100/30">
                                <p class="text-2xl font-bold mb-10 tracking-tight text-gray-700" x-text="getKSTMonthYear()"></p>
                                
                                <div class="calendar-grid mb-12">
                                    <template x-for="day in ['Ïùº','Ïõî','Ìôî','Ïàò','Î™©','Í∏à','ÌÜ†']">
                                        <div class="text-[10px] font-bold py-2" :class="day === 'Ïùº' ? 'text-rose-400' : (day === 'ÌÜ†' ? 'text-sky-400' : 'text-gray-300')" x-text="day"></div>
                                    </template>
                                    
                                    <!-- Leading empty cells -->
                                    <template x-for="empty in getStartDayOfMonth()">
                                        <div class="day-cell"></div>
                                    </template>
                                    
                                    <!-- Actual days -->
                                    <template x-for="d in getDaysInMonth()">
                                        <div class="day-cell"
                                             :class="isWeddingDay(d) ? 'bg-rose-400 text-white font-bold scale-110 shadow-lg' : 'text-gray-600'"
                                             x-text="d"></div>
                                    </template>
                                </div>

                                <div class="pt-10 border-t border-gray-100 space-y-2">
                                    <p class="text-xs text-gray-300 tracking-widest uppercase">Wedding Countdown</p>
                                    <p class="text-rose-400 font-bold tracking-[0.2em] text-2xl" x-text="calculateDDayKST()"></p>
                                </div>
                            </div>
                        </div>
                    </template>

                    <!-- Location Section -->
                    <template x-if="section.id === 'location'">
                        <div class="py-12 space-y-10 text-left">
                            <div class="space-y-3">
                                <p class="text-xs text-rose-300 tracking-widest uppercase">The Venue</p>
                                <h3 class="text-2xl font-bold tracking-tight" x-text="data.venue.name"></h3>
                                <p class="text-sm text-gray-400" x-text="data.venue.address"></p>
                                <div class="flex gap-4 pt-2">
                                    <a :href="`tel:${data.venue.phone}`" class="text-xs text-gray-500 hover:text-rose-300 transition-colors">Tel. <span x-text="data.venue.phone"></span></a>
                                </div>
                            </div>
                            <!-- Mock Map -->
                            <div class="aspect-video bg-gray-50 rounded-[2rem] flex items-center justify-center border border-gray-100 shadow-inner group cursor-pointer overflow-hidden relative">
                                <div class="absolute inset-0 bg-rose-50 opacity-0 group-hover:opacity-10 transition-opacity"></div>
                                <div class="text-center space-y-2 z-10">
                                    <p class="text-[10px] text-gray-300 tracking-widest uppercase">Interactive Map</p>
                                    <p class="text-xs text-gray-400 italic">Click to open Navigation</p>
                                </div>
                            </div>
                        </div>
                    </template>

                </div>
            </div>
        </template>
    </main>

    <footer class="py-32 bg-gray-50/50 text-center border-t border-gray-100 relative overflow-hidden">
        <div class="relative z-10">
            <p class="text-[10px] text-gray-300 tracking-[0.6em] mb-6 uppercase">Eternal Love & Promise</p>
            <p class="text-[10px] text-gray-300 font-light tracking-widest italic">COPYRIGHT(C) JOE ALL RIGHT RESERVED</p>
            <div class="mt-12">
                <a href="admin.html" class="text-[9px] text-gray-200 hover:text-rose-300 transition-colors border border-gray-100 px-4 py-2 rounded-full bg-white">ADMIN TERMINAL</a>
            </div>
        </div>
    </footer>

    <script>
        const LANG_LIST = {
            ko: { name: 'ÌïúÍµ≠Ïñ¥', flag: 'üá∞üá∑' },
            en: { name: 'English', flag: 'üá¨üáß' },
            jp: { name: 'Êó•Êú¨Ë™û', flag: 'üáØüáµ' },
            cn: { name: 'ÁÆÄ‰Ωì‰∏≠Êñá', flag: 'üá®üá≥' }
        };

        function weddingApp() {
            return {
                showIntro: true,
                bgmPlaying: false,
                audio: null,
                playPromise: null,
                currentLang: LANG_LIST.ko,
                languages: Object.values(LANG_LIST),
                data: {},
                sortedSections: [],
                
                async init() {
                    const saved = localStorage.getItem('wedding_v2_data');
                    this.data = saved ? JSON.parse(saved) : this.getInitialState();
                    this.sortedSections = [...this.data.sections].sort((a, b) => a.order - b.order);
                    
                    const observer = new IntersectionObserver((entries) => {
                        entries.forEach(entry => {
                            if (entry.isIntersecting) entry.target.classList.add('active');
                        });
                    }, { threshold: 0.1 });
                    
                    this.$nextTick(() => {
                        document.querySelectorAll('.reveal').forEach(el => observer.observe(el));
                        this.initCanvas();
                    });

                    this.setupAudio();
                },

                getInitialState() {
                    return {
                        mainImage: 'https://images.unsplash.com/photo-1519741497674-611481863552?q=80&w=2070',
                        overlayText: 'Our Wedding',
                        mainText: 'Î¥ÑÏùò Îî∞Ïä§Ìï®Ïù¥ Í∞ÄÎìùÌïú ÎÇ†,\nÏ†ÄÌù¨ Îëê ÏÇ¨ÎûåÏùò ÏÜåÏ§ëÌïú Ïó∞ÏùÑ Îß∫Í≥†Ïûê Ìï©ÎãàÎã§.\n\nÌï®Íªò ÏûêÎ¶¨Î•º ÎπõÎÇ¥Ï£ºÏãúÎ©¥\nÎçîÏóÜÎäî Í∏∞ÏÅ®ÏúºÎ°ú Í∞ÑÏßÅÌïòÍ≤†ÏäµÎãàÎã§.',
                        groom: { name: 'Ï°∞ÌòÑÏö∞', father: 'Ï°∞Î≥µÎûò', mother: 'ÎÇòÏÑ†Ìù¨', rank: 'Ïû•ÎÇ®', phone: '010-3366-4848' },
                        bride: { name: 'Î•òÌïòÏòÅ', father: 'Î•òÎØºÏÑù', mother: 'Í≥†Ïö∞Ìù¨', rank: 'Ïû•ÎÖÄ', phone: '010-6556-7525' },
                        weddingDate: '2026-05-02T13:00:00',
                        venue: { name: 'ÎßàÎ¶¨ÏïÑÏ•¨ Ïä§ÌÄòÏñ¥', address: 'ÏÑúÏö∏ÌäπÎ≥ÑÏãú Í∞ïÎÇ®Íµ¨ ÎèÑÏÇ∞ÎåÄÎ°ú 318', phone: '02-541-5007' },
                        sections: [
                            { id: 'mainText', title: 'INVITATION', isVisible: true, isFolded: false, order: 0 },
                            { id: 'names', title: 'WHO WE ARE', isVisible: true, isFolded: false, order: 1 },
                            { id: 'calendar', title: 'SCHEDULE', isVisible: true, isFolded: false, order: 2 },
                            { id: 'location', title: 'LOCATION', isVisible: true, isFolded: false, order: 3 }
                        ]
                    };
                },

                setupAudio() {
                    this.audio = new Audio('https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3');
                    this.audio.loop = true;
                    this.audio.preload = 'auto';
                },

                async toggleBgm() {
                    if (!this.audio) this.setupAudio();
                    
                    try {
                        if (this.bgmPlaying) {
                            // If we have an active play promise, wait for it before pausing
                            if (this.playPromise) await this.playPromise;
                            this.audio.pause();
                            this.bgmPlaying = false;
                        } else {
                            this.playPromise = this.audio.play();
                            if (this.playPromise !== undefined) {
                                await this.playPromise;
                                this.bgmPlaying = true;
                                this.playPromise = null;
                            }
                        }
                    } catch (err) {
                        console.warn("BGM state change was interrupted:", err.name);
                        this.bgmPlaying = false;
                    }
                },

                closeIntro() {
                    this.showIntro = false;
                    document.body.style.overflow = 'auto';
                },

                formatDateKST(iso) {
                    const d = new Date(iso);
                    return d.toLocaleDateString('ko-KR', { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' });
                },

                getKSTMonthYear() {
                    const d = new Date(this.data.weddingDate);
                    return `${d.getFullYear()} / ${String(d.getMonth() + 1).padStart(2, '0')}`;
                },

                getStartDayOfMonth() {
                    const d = new Date(this.data.weddingDate);
                    // 1st day of the wedding month
                    return new Date(d.getFullYear(), d.getMonth(), 1).getDay();
                },

                getDaysInMonth() {
                    const d = new Date(this.data.weddingDate);
                    return new Date(d.getFullYear(), d.getMonth() + 1, 0).getDate();
                },

                isWeddingDay(day) {
                    return day === new Date(this.data.weddingDate).getDate();
                },

                calculateDDayKST() {
                    const now = new Date();
                    // Explicitly calculate Korea Standard Time
                    const kstNow = new Date(now.toLocaleString("en-US", {timeZone: "Asia/Seoul"}));
                    const target = new Date(this.data.weddingDate);
                    const kstTarget = new Date(target.toLocaleString("en-US", {timeZone: "Asia/Seoul"}));
                    
                    // Midnight normalization for pure day count
                    kstNow.setHours(0,0,0,0);
                    kstTarget.setHours(0,0,0,0);
                    
                    const diff = kstTarget - kstNow;
                    const days = Math.round(diff / (1000 * 60 * 60 * 24));
                    
                    if (days > 0) return `D-${days}`;
                    if (days === 0) return 'D-DAY';
                    return `D+${Math.abs(days)}`;
                },

                runTTS() {
                    const synth = window.speechSynthesis;
                    if (synth.speaking) { synth.cancel(); return; }
                    const msg = new SpeechSynthesisUtterance(this.data.mainText);
                    msg.lang = 'ko-KR';
                    msg.pitch = 1.0;
                    msg.rate = 0.95;
                    synth.speak(msg);
                },

                initCanvas() {
                    const canvas = document.getElementById('interactive-canvas');
                    const ctx = canvas.getContext('2d');
                    let particles = [];
                    const resize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };
                    window.addEventListener('resize', resize);
                    resize();

                    class Particle {
                        constructor(x, y) {
                            this.x = x; this.y = y;
                            this.size = Math.random() * 2 + 0.3;
                            this.speedX = Math.random() * 1.5 - 0.75;
                            this.speedY = Math.random() * 1.5 - 0.75;
                            this.opacity = 0.8;
                        }
                        update() { this.x += this.speedX; this.y += this.speedY; this.opacity -= 0.012; }
                        draw() {
                            ctx.fillStyle = `rgba(212, 175, 55, ${this.opacity})`;
                            ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2); ctx.fill();
                        }
                    }

                    const animate = () => {
                        ctx.clearRect(0, 0, canvas.width, canvas.height);
                        particles = particles.filter(p => p.opacity > 0);
                        particles.forEach(p => { p.update(); p.draw(); });
                        requestAnimationFrame(animate);
                    };
                    animate();

                    this.addParticle = (x, y) => { for(let i=0; i<4; i++) particles.push(new Particle(x, y)); };
                },

                handleMouseMove(e) { this.addParticle?.(e.clientX, e.clientY); },
                handleTouchMove(e) { if(e.touches[0]) this.addParticle?.(e.touches[0].clientX, e.touches[0].clientY); }
            }
        }
    </script>
</body>
</html>
