
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title x-data x-text="$store.weddingTitle || 'ëª¨ë°”ì¼ ì²­ì²©ì¥'"></title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Gowun+Batang:wght@400;700&family=Nanum+Myeongjo:wght@400;700&family=Noto+Serif+KR:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=dacffa882aa3284870d06afa02bd5947&libraries=services&autoload=false"></script>
    <style>
        :root { --accent: #f2aebc; --text: #333; --bg: #ffffff; }
        body { font-family: 'Gowun Batang', serif; color: var(--text); background: var(--bg); overflow-x: hidden; scroll-behavior: smooth; }
        [x-cloak] { display: none !important; }
        .lux-font { font-family: 'Nanum Myeongjo', serif; }
        
        /* Particle Layer */
        #effect-canvas { position: fixed; top: 0; left: 0; pointer-events: none; z-index: 50; }

        /* Performance Optimized Transitions */
        .section-fold-content { 
            display: grid;
            grid-template-rows: 0fr;
            transition: grid-template-rows 0.4s ease-out;
            overflow: hidden;
        }
        .section-fold-content.open { grid-template-rows: 1fr; }
        .section-fold-inner { min-height: 0; }

        /* Calendar */
        .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); text-align: center; border: 1px solid #eee; }
        .cal-cell { aspect-ratio: 1/1; display: flex; align-items: center; justify-content: center; font-size: 1.1rem; border: 0.5px solid #f9f9f9; }
        .cal-header { font-weight: bold; padding: 10px 0; background: #fdfdfd; font-size: 0.9rem; }
        .cal-sat { color: #3b82f6; }
        .cal-sun { color: #ef4444; }
        .cal-wedding { background: var(--accent); color: white; border-radius: 50%; width: 36px; height: 36px; margin: auto; display: flex; align-items: center; justify-content: center; font-weight: bold; }

        /* Buttons & UI */
        .btn-action { border: 1px solid #eee; padding: 12px 20px; border-radius: 4px; font-size: 0.9rem; transition: 0.3s; background: white; }
        .btn-action:hover { border-color: var(--accent); color: var(--accent); }
        .section-sep { height: 1px; background: linear-gradient(to right, transparent, #eee, transparent); margin: 2rem 0; }
        
        .modal-dim { position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 1000; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(4px); }
    </style>
</head>
<body x-data="weddingApp()" x-init="init()">

    <canvas id="effect-canvas"></canvas>

    <!-- BGM UI -->
    <div class="fixed top-6 right-6 z-[200]">
        <button @click="toggleBgm()" class="w-12 h-12 bg-white/80 backdrop-blur rounded-full border border-gray-100 shadow-lg flex items-center justify-center text-xl">
            <span x-text="bgmPlaying ? 'â¸' : 'â–¶ï¸'"></span>
        </button>
        <audio id="bgm-player" loop src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3"></audio>
    </div>

    <!-- Hero Section (Unfoldable) -->
    <section class="min-h-screen relative flex flex-col">
        <div class="relative w-full h-[70vh] overflow-hidden">
            <img :src="data.mainImage" class="w-full h-full object-cover">
            <div class="absolute inset-0 flex flex-col p-12 text-white" 
                 :class="{'justify-start': data.overlayPos === 'top', 'justify-center items-center': data.overlayPos === 'middle', 'justify-end': data.overlayPos === 'bottom'}">
                <h1 class="lux-font italic text-6xl md:text-8xl drop-shadow-2xl" x-text="data.overlayText"></h1>
            </div>
        </div>
        <div class="flex-1 bg-white py-16 px-8 text-center animate__animated animate__fadeInUp">
            <pre class="text-xl md:text-2xl leading-relaxed whitespace-pre-wrap font-medium text-gray-700" x-text="data.mainMessage"></pre>
        </div>
    </section>

    <!-- Dynamic Sections -->
    <main class="max-w-3xl mx-auto px-6 pb-24">
        <template x-for="section in sortedSections" :key="section.id">
            <div x-show="section.isVisible" class="mb-4">
                <div class="section-sep"></div>
                <!-- Section Header -->
                <div @click="toggleFold(section)" class="flex justify-between items-center py-6 cursor-pointer group">
                    <h2 class="text-2xl font-bold tracking-widest text-gray-800 group-hover:text-pink-400 transition-colors" x-text="section.title"></h2>
                    <span class="text-xl text-gray-300" x-text="section.isFolded ? 'â–¼' : 'â–²'"></span>
                </div>

                <div class="section-fold-content" :class="!section.isFolded ? 'open' : ''">
                    <div class="section-fold-inner space-y-8 pb-10">
                        
                        <!-- 2. Names -->
                        <template x-if="section.id === 'names'">
                            <div class="grid grid-cols-2 gap-8 text-center bg-pink-50/30 p-8 rounded-2xl">
                                <div class="space-y-4">
                                    <p class="text-xs text-pink-400 font-bold tracking-widest uppercase">Groom</p>
                                    <h3 class="text-3xl font-bold" x-text="data.groom.name"></h3>
                                    <div class="text-sm text-gray-500 space-y-1">
                                        <p x-text="`${data.groom.father} Â· ${data.groom.mother}`"></p>
                                        <p class="italic" x-text="'ì˜ ' + data.groom.rank"></p>
                                    </div>
                                </div>
                                <div class="space-y-4 border-l border-white">
                                    <p class="text-xs text-pink-400 font-bold tracking-widest uppercase">Bride</p>
                                    <h3 class="text-3xl font-bold" x-text="data.bride.name"></h3>
                                    <div class="text-sm text-gray-500 space-y-1">
                                        <p x-text="`${data.bride.father} Â· ${data.bride.mother}`"></p>
                                        <p class="italic" x-text="'ì˜ ' + data.bride.rank"></p>
                                    </div>
                                </div>
                            </div>
                        </template>

                        <!-- 3. Calendar -->
                        <template x-if="section.id === 'calendar'">
                            <div class="space-y-10">
                                <div class="bg-white border p-6 rounded-xl shadow-sm">
                                    <h4 class="text-2xl font-bold text-center mb-6" x-text="getCalTitle()"></h4>
                                    <div class="cal-grid">
                                        <template x-for="h in ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† ']">
                                            <div class="cal-header" :class="h==='ì¼'?'cal-sun':(h==='í† '?'cal-sat':'')" x-text="h"></div>
                                        </template>
                                        <template x-for="e in getCalStartDay()"><div></div></template>
                                        <template x-for="d in getCalDays()">
                                            <div class="cal-cell">
                                                <div :class="isWeddingDay(d) ? 'cal-wedding' : (getCalDayNum(d)===0 ? 'cal-sun' : (getCalDayNum(d)===6 ? 'cal-sat' : ''))" x-text="d"></div>
                                            </div>
                                        </template>
                                    </div>
                                    <div class="mt-10 text-center space-y-3">
                                        <p class="text-xs text-gray-400 font-bold tracking-[0.3em] uppercase">Countdown</p>
                                        <p class="text-3xl font-bold text-pink-500 font-mono" x-text="timerText"></p>
                                    </div>
                                </div>
                            </div>
                        </template>

                        <!-- 4. YouTube -->
                        <template x-if="section.id === 'youtube'">
                            <div class="relative aspect-video rounded-xl overflow-hidden shadow-lg group cursor-pointer" @click="openYoutube()">
                                <img :src="`https://img.youtube.com/vi/${getYoutubeId()}/maxresdefault.jpg`" class="w-full h-full object-cover">
                                <div class="absolute inset-0 bg-black/30 flex items-center justify-center">
                                    <div class="w-20 h-20 bg-white/90 rounded-full flex items-center justify-center text-4xl group-hover:scale-110 transition-transform">â–¶ï¸</div>
                                </div>
                            </div>
                        </template>

                        <!-- 5. Gallery -->
                        <template x-if="section.id === 'gallery'">
                            <div class="space-y-6">
                                <div class="relative aspect-[4/5] md:aspect-video rounded-2xl overflow-hidden shadow-xl">
                                    <template x-for="(img, i) in data.gallery" :key="i">
                                        <img :src="img" class="absolute inset-0 w-full h-full object-cover transition-opacity duration-1000"
                                             :class="galIdx === i ? 'opacity-100' : 'opacity-0'"
                                             @click="openGallery(img)">
                                    </template>
                                    <div class="absolute inset-y-0 left-0 w-16 flex items-center justify-center text-white text-3xl cursor-pointer" @click="galIdx = (galIdx - 1 + data.gallery.length) % data.gallery.length">â®</div>
                                    <div class="absolute inset-y-0 right-0 w-16 flex items-center justify-center text-white text-3xl cursor-pointer" @click="galIdx = (galIdx + 1) % data.gallery.length">â¯</div>
                                </div>
                                <div class="grid grid-cols-5 gap-2">
                                    <template x-for="(img, i) in data.gallery" :key="i">
                                        <div @click="galIdx = i" class="aspect-square cursor-pointer border-2 transition-all rounded-md overflow-hidden" 
                                             :class="galIdx === i ? 'border-pink-300 scale-95' : 'border-transparent opacity-60'">
                                            <img :src="img" class="w-full h-full object-cover">
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </template>

                        <!-- 6. Phone -->
                        <template x-if="section.id === 'phone'">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="bg-gray-50 p-6 rounded-2xl space-y-4">
                                    <p class="text-xs font-bold text-gray-400 uppercase">ì‹ ë‘ì¸¡ ì—°ë½ì²˜</p>
                                    <template x-for="p in getGroomPhones()">
                                        <div class="flex justify-between items-center bg-white p-4 rounded-xl border border-gray-100 shadow-sm">
                                            <span class="font-bold text-sm" x-text="p.label"></span>
                                            <a :href="`tel:${p.val}`" class="w-10 h-10 bg-green-50 text-green-600 rounded-full flex items-center justify-center text-xl">ğŸ“</a>
                                        </div>
                                    </template>
                                </div>
                                <div class="bg-pink-50/30 p-6 rounded-2xl space-y-4">
                                    <p class="text-xs font-bold text-pink-300 uppercase">ì‹ ë¶€ì¸¡ ì—°ë½ì²˜</p>
                                    <template x-for="p in getBridePhones()">
                                        <div class="flex justify-between items-center bg-white p-4 rounded-xl border border-pink-50 shadow-sm">
                                            <span class="font-bold text-sm" x-text="p.label"></span>
                                            <a :href="`tel:${p.val}`" class="w-10 h-10 bg-pink-50 text-pink-600 rounded-full flex items-center justify-center text-xl">ğŸ“</a>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </template>

                        <!-- 7. Accounts -->
                        <template x-if="section.id === 'accounts'">
                            <div class="space-y-6">
                                <div class="bg-gray-50 p-6 rounded-2xl space-y-4">
                                    <p class="text-xs font-bold text-gray-400 uppercase">ì‹ ë‘ì¸¡ ê³„ì¢Œë²ˆí˜¸</p>
                                    <template x-for="a in getGroomAccounts()">
                                        <div class="bg-white p-5 rounded-xl border border-gray-100 space-y-2">
                                            <div class="flex justify-between text-sm">
                                                <span class="font-bold" x-text="a.label"></span>
                                                <span class="text-gray-400" x-text="a.bank"></span>
                                            </div>
                                            <div class="flex justify-between items-center">
                                                <span class="text-lg font-mono font-bold" x-text="a.val"></span>
                                                <button @click="copy(a.val)" class="text-[10px] bg-gray-100 px-3 py-1 rounded">ë³µì‚¬</button>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                                <div class="bg-pink-50/30 p-6 rounded-2xl space-y-4">
                                    <p class="text-xs font-bold text-pink-300 uppercase">ì‹ ë¶€ì¸¡ ê³„ì¢Œë²ˆí˜¸</p>
                                    <template x-for="a in getBrideAccounts()">
                                        <div class="bg-white p-5 rounded-xl border border-pink-50 space-y-2">
                                            <div class="flex justify-between text-sm">
                                                <span class="font-bold" x-text="a.label"></span>
                                                <span class="text-gray-400" x-text="a.bank"></span>
                                            </div>
                                            <div class="flex justify-between items-center">
                                                <span class="text-lg font-mono font-bold" x-text="a.val"></span>
                                                <button @click="copy(a.val)" class="text-[10px] bg-pink-50 px-3 py-1 rounded">ë³µì‚¬</button>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </template>

                        <!-- 8. Location -->
                        <template x-if="section.id === 'location'">
                            <div class="space-y-8">
                                <div class="text-center space-y-2">
                                    <h3 class="text-3xl font-bold" x-text="data.venue.name"></h3>
                                    <p class="text-gray-400" x-text="data.venue.address"></p>
                                    <div class="flex justify-center gap-6 py-4">
                                        <a :href="`tel:${data.venue.phone}`" class="text-sm border-b">ì „í™”í•˜ê¸°</a>
                                        <a :href="data.venue.homepage" target="_blank" class="text-sm border-b">í™ˆí˜ì´ì§€</a>
                                    </div>
                                </div>
                                <div id="map" style="width:100%;height:300px;" class="rounded-xl shadow-inner"></div>
                                <div class="flex justify-center gap-4">
                                    <button @click="openExternalMap('naver')" class="flex flex-col items-center gap-1">
                                        <div class="w-12 h-12 bg-[#03C75A] text-white rounded-xl flex items-center justify-center font-bold">N</div>
                                        <span class="text-[10px]">ë„¤ì´ë²„</span>
                                    </button>
                                    <button @click="openExternalMap('kakao')" class="flex flex-col items-center gap-1">
                                        <div class="w-12 h-12 bg-[#FEE500] text-black rounded-xl flex items-center justify-center font-bold">K</div>
                                        <span class="text-[10px]">ì¹´ì¹´ì˜¤</span>
                                    </button>
                                    <button @click="openExternalMap('tmap')" class="flex flex-col items-center gap-1">
                                        <div class="w-12 h-12 bg-[#E10000] text-white rounded-xl flex items-center justify-center font-bold">T</div>
                                        <span class="text-[10px]">í‹°ë§µ</span>
                                    </button>
                                </div>
                                <div class="bg-gray-50 p-8 rounded-2xl">
                                    <pre class="text-sm leading-loose whitespace-pre-wrap text-gray-600" x-text="data.venue.guideText"></pre>
                                </div>
                            </div>
                        </template>

                        <!-- 11. Guestbook -->
                        <template x-if="section.id === 'guestbook'">
                            <div class="space-y-6">
                                <template x-for="g in data.guestbook.slice(0, 3)">
                                    <div class="p-6 bg-white border border-gray-100 rounded-2xl shadow-sm relative">
                                        <p class="text-xs font-bold text-pink-300 mb-2" x-text="g.name"></p>
                                        <p class="text-base text-gray-700 font-light" x-text="g.content"></p>
                                        <span class="absolute top-6 right-6 text-[10px] text-gray-200" x-text="g.date"></span>
                                    </div>
                                </template>
                                <div class="grid grid-cols-2 gap-4">
                                    <button @click="showGuestbookModal = true" class="btn-action w-full font-bold">ë°©ëª…ë¡ ì‘ì„±í•˜ê¸°</button>
                                    <button @click="showAllGuestbook = true" class="btn-action w-full">ì „ì²´ ë°©ëª…ë¡ ë³´ê¸°</button>
                                </div>
                            </div>
                        </template>

                        <!-- 12. RSVP -->
                        <template x-if="section.id === 'rsvp'">
                            <div class="bg-gray-50 p-8 rounded-3xl text-center space-y-8">
                                <p class="text-sm text-gray-500">ì¶•í•˜ì˜ ë§ˆìŒìœ¼ë¡œ ì°¸ì„ ì—¬ë¶€ë¥¼ ì•Œë ¤ì£¼ì‹œë©´<br>ì›í™œí•œ ì˜ˆì‹ ì¤€ë¹„ì— í° ë„ì›€ì´ ë©ë‹ˆë‹¤.</p>
                                <button @click="showRsvpModal = true" class="w-full py-5 bg-gray-800 text-white rounded-xl font-bold tracking-widest shadow-xl shadow-gray-200">ì°¸ì„ ì—¬ë¶€ ì „ë‹¬í•˜ê¸°</button>
                            </div>
                        </template>

                        <!-- 13. Share -->
                        <template x-if="section.id === 'share'">
                            <div class="flex justify-center gap-6 py-6">
                                <button @click="share('kakao')" class="w-14 h-14 bg-[#FEE500] rounded-full flex items-center justify-center shadow-md">ğŸ’¬</button>
                                <button @click="share('facebook')" class="w-14 h-14 bg-[#1877F2] text-white rounded-full flex items-center justify-center shadow-md text-2xl">f</button>
                                <button @click="share('x')" class="w-14 h-14 bg-black text-white rounded-full flex items-center justify-center shadow-md text-xl">ğ•</button>
                                <button @click="copyLink()" class="w-14 h-14 bg-gray-200 rounded-full flex items-center justify-center shadow-md">ğŸ”—</button>
                            </div>
                        </template>

                    </div>
                </div>
            </div>
        </template>
    </main>

    <footer class="py-24 text-center border-t border-gray-50 bg-gray-50/30">
        <p class="text-gray-300 tracking-[0.6em] text-xs font-bold uppercase mb-4">Forever & Ever</p>
        <p class="text-gray-300 text-[10px] font-light">Copyright(c) Joe All Right Reserved</p>
    </footer>

    <!-- Modals -->
    <!-- Youtube Modal -->
    <div x-show="showYoutube" x-transition.opacity class="modal-dim" @click="showYoutube = false">
        <div class="w-full max-w-4xl aspect-video px-4" @click.stop>
            <iframe :src="`https://www.youtube.com/embed/${getYoutubeId()}?autoplay=1`" class="w-full h-full rounded-2xl shadow-2xl" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
        </div>
    </div>

    <!-- Gallery Modal -->
    <div x-show="showGalModal" x-transition.opacity class="modal-dim" @click="showGalModal = false">
        <img :src="activeImg" class="max-w-[95%] max-h-[90vh] object-contain rounded-xl shadow-2xl animate__animated animate__zoomIn">
    </div>

    <!-- RSVP Modal -->
    <div x-show="showRsvpModal" x-transition class="modal-dim z-[2000]" @click="showRsvpModal = false">
        <div class="bg-white w-[90%] max-w-md p-10 rounded-3xl space-y-8" @click.stop>
            <h3 class="text-2xl font-bold text-center">ì°¸ì„ ì—¬ë¶€ ì „ë‹¬</h3>
            <div class="flex gap-2">
                <button @click="rsvpSide = 'groom'" class="flex-1 py-3 rounded-lg border font-bold" :class="rsvpSide === 'groom' ? 'bg-blue-50 border-blue-200 text-blue-600' : 'bg-white'">ì‹ ë‘ì¸¡</button>
                <button @click="rsvpSide = 'bride'" class="flex-1 py-3 rounded-lg border font-bold" :class="rsvpSide === 'bride' ? 'bg-pink-50 border-pink-200 text-pink-600' : 'bg-white'">ì‹ ë¶€ì¸¡</button>
            </div>
            <div class="space-y-4">
                <div class="flex gap-4">
                    <label class="flex-1 flex items-center justify-center border p-4 rounded-xl cursor-pointer" :class="rsvpForm.attend ? 'bg-gray-800 text-white' : ''">
                        <input type="radio" x-model="rsvpForm.attend" :value="true" class="hidden"> ì°¸ì„
                    </label>
                    <label class="flex-1 flex items-center justify-center border p-4 rounded-xl cursor-pointer" :class="!rsvpForm.attend ? 'bg-gray-800 text-white' : ''">
                        <input type="radio" x-model="rsvpForm.attend" :value="false" class="hidden"> ë¶ˆì°¸
                    </label>
                </div>
                <input type="text" x-model="rsvpForm.name" placeholder="ì„±í•¨ ì…ë ¥" class="w-full p-5 bg-gray-50 rounded-xl outline-none focus:ring-2 ring-pink-100">
                <input type="text" x-model="rsvpForm.phone" placeholder="010-0000-0000" class="w-full p-5 bg-gray-50 rounded-xl outline-none focus:ring-2 ring-pink-100">
                <template x-if="rsvpForm.attend">
                    <div class="space-y-4">
                        <div class="flex gap-4">
                            <label class="flex-1 flex items-center justify-center border p-4 rounded-xl cursor-pointer" :class="rsvpForm.meal ? 'bg-gray-800 text-white' : ''">
                                <input type="radio" x-model="rsvpForm.meal" :value="true" class="hidden"> ì‹ì‚¬ ì˜ˆì •
                            </label>
                            <label class="flex-1 flex items-center justify-center border p-4 rounded-xl cursor-pointer" :class="!rsvpForm.meal ? 'bg-gray-800 text-white' : ''">
                                <input type="radio" x-model="rsvpForm.meal" :value="false" class="hidden"> ì‹ì‚¬ ë¯¸ì˜ˆì •
                            </label>
                        </div>
                        <div x-show="rsvpForm.meal" class="flex items-center gap-4">
                            <span class="text-sm">ë³¸ì¸ í¬í•¨</span>
                            <input type="number" x-model="rsvpForm.plusOnes" class="w-20 p-4 border rounded-xl text-center">
                            <span class="text-sm">ëª…</span>
                        </div>
                    </div>
                </template>
            </div>
            <button @click="submitRsvp()" class="w-full py-5 bg-pink-400 text-white rounded-xl font-bold shadow-xl shadow-pink-100">ì „ë‹¬í•˜ê¸°</button>
        </div>
    </div>

    <!-- Guestbook Write Modal -->
    <div x-show="showGuestbookModal" x-transition class="modal-dim z-[2000]" @click="showGuestbookModal = false">
        <div class="bg-white w-[90%] max-w-md p-10 rounded-3xl space-y-6" @click.stop>
            <h3 class="text-2xl font-bold">ì¶•ë³µì˜ ë©”ì‹œì§€</h3>
            <input type="text" x-model="gbForm.name" placeholder="ì„±í•¨ì„ ì…ë ¥í•´ì£¼ì„¸ìš”." maxlength="20" class="w-full p-5 bg-gray-50 rounded-xl outline-none">
            <textarea x-model="gbForm.content" placeholder="ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”. (ìµœëŒ€ 255ì)" maxlength="255" rows="5" class="w-full p-5 bg-gray-50 rounded-xl outline-none resize-none"></textarea>
            <p class="text-[10px] text-gray-400">ë¹„ë°©ì´ë‚˜ ìš•ì„¤ ë“± ë¶€ì ì ˆí•œ ë‚´ìš©ì€ ê´€ë¦¬ìì— ì˜í•´ ì‚­ì œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            <button @click="submitGuestbook()" class="w-full py-5 bg-gray-800 text-white rounded-xl font-bold">ì‘ì„±í•˜ê¸°</button>
        </div>
    </div>

    <script>
        function weddingApp() {
            return {
                isLoaded: false,
                bgmPlaying: false,
                galIdx: 0,
                timerText: '',
                showYoutube: false,
                showGalModal: false,
                showRsvpModal: false,
                showGuestbookModal: false,
                showAllGuestbook: false,
                activeImg: '',
                rsvpSide: 'groom',
                rsvpForm: { attend: true, name: '', phone: '', meal: true, plusOnes: 1 },
                gbForm: { name: '', content: '' },
                data: {},
                sortedSections: [],

                async init() {
                    const saved = localStorage.getItem('wedding_v2_data');
                    this.data = saved ? JSON.parse(saved) : this.getInitialState();
                    this.sortedSections = [...this.data.sections].sort((a, b) => a.order - b.order);
                    
                    window.dispatchEvent(new Event('alpine:init-done'));
                    document.title = `Â§${this.data.groom.name}Â§ â™¥ Â§${this.data.bride.name}Â§ì˜ ëª¨ë°”ì¼ ì²­ì²©ì¥`;

                    this.initPetals();
                    this.initTimer();
                    this.initMap();
                    this.initReveal();
                    
                    this.isLoaded = true;
                    setInterval(() => { this.galIdx = (this.galIdx + 1) % this.data.gallery.length; }, 5000);
                },

                getInitialState() {
                    return {
                        mainImage: 'https://images.unsplash.com/photo-1511795409834-ef04bbd61622?q=80&w=2069',
                        overlayText: 'Wedding Invitation',
                        overlayPos: 'top',
                        mainMessage: 'ì¡°í˜„ìš° ê·¸ë¦¬ê³  ë¥˜í•˜ì˜\n\n2026ë…„ 05ì›” 02ì¼ í† ìš”ì¼ PM 13ì‹œ 00ë¶„\nê°•ë‚¨ ë§ˆë¦¬ì•„ì¥¬ ìŠ¤í€˜ì–´\n\nì˜ì›íˆ í•¨ê»˜í• \nì‚¬ë‘ì˜ ë§¹ì„¸\nê°™ì´ ì¶•ë³µí•´ì£¼ì„¸ìš”.',
                        weddingDate: '2026-05-02T13:00:00',
                        youtubeLink: 'https://youtu.be/UmdCDfXQ8wQ?si=IirtVYdyD2qBEybR',
                        groom: { name: 'ì¡°í˜„ìš°', father: 'ì¡°ë³µë˜', mother: 'ë‚˜ì„ í¬', rank: 'ì¥ë‚¨', phone: '010-3366-4848', accLabel: 'ì¡°í˜„ìš°', acc: '040-086067-01-014', bank: 'ê¸°ì—…' },
                        bride: { name: 'ë¥˜í•˜ì˜', father: 'ë¥˜ë¯¼ì„', mother: 'ê³ ìš°í¬', rank: 'ì¥ë…€', phone: '010-6556-7525', accLabel: 'ë¥˜í•˜ì˜', acc: '926-54-7559-46', bank: 'êµ­ë¯¼' },
                        groomParents: { fPhone: '010-9090-0824', mPhone: '010-9877-0824', fAcc: '109-08-072450', fBank: 'ìš°ë¦¬', mAcc: '110-587-170868', mBank: 'ì‹ í•œ' },
                        brideParents: { fPhone: '010-5356-7558', mPhone: '010-9858-7551', fAcc: '302-5356-7558-41', fBank: 'ë†í˜‘', mAcc: '339-06-063092', mBank: 'ì‹ í•œ' },
                        gallery: [
                            'https://images.unsplash.com/photo-1583939003579-730e3918a45a?w=1000',
                            'https://images.unsplash.com/photo-1519225421980-715cb0215aed?w=1000',
                            'https://images.unsplash.com/photo-1519741497674-611481863552?w=1000',
                            'https://images.unsplash.com/photo-1520854221256-17451cc331bf?w=1000',
                            'https://images.unsplash.com/photo-1511285560929-80b456fea0bc?w=1000',
                            'https://images.unsplash.com/photo-1510076857177-7470076d4098?w=1000'
                        ],
                        venue: {
                            name: 'ë§ˆë¦¬ì•„ì¥¬ ìŠ¤í€˜ì–´',
                            address: 'ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ ë„ì‚°ëŒ€ë¡œ 318 SBíƒ€ì›Œ Gì¸µ',
                            phone: '02-541-5007',
                            homepage: 'http://www.mariagesquare.com/',
                            guideText: 'ì…”í‹€ìš´í–‰\n7í˜¸ì„ , ë¶„ë‹¹ì„  ê°•ë‚¨êµ¬ì²­ì—­ 3ë²ˆì¶œêµ¬ ì…”í‹€ë²„ìŠ¤ ì´ìš©\n\nì§€í•˜ì² \nê°•ë‚¨êµ¬ì²­ì—­ 3-1ë²ˆ ì¶œêµ¬ ë„ë³´ 600M'
                        },
                        sections: [
                            { id: 'names', title: 'WHO WE ARE', isVisible: true, isFolded: false, order: 1 },
                            { id: 'calendar', title: 'DATE', isVisible: true, isFolded: false, order: 2 },
                            { id: 'youtube', title: 'CINEMA', isVisible: true, isFolded: true, order: 3 },
                            { id: 'gallery', title: 'GALLERY', isVisible: true, isFolded: true, order: 4 },
                            { id: 'phone', title: 'CONTACT', isVisible: true, isFolded: true, order: 5 },
                            { id: 'accounts', title: 'GIFT', isVisible: true, isFolded: true, order: 6 },
                            { id: 'location', title: 'LOCATION', isVisible: true, isFolded: false, order: 7 },
                            { id: 'guestbook', title: 'GUESTBOOK', isVisible: true, isFolded: true, order: 8 },
                            { id: 'rsvp', title: 'RSVP', isVisible: true, isFolded: false, order: 9 },
                            { id: 'share', title: 'SHARE', isVisible: true, isFolded: true, order: 10 }
                        ],
                        guestbook: [
                            { name: 'ì¡°í˜„ìš°', content: 'ë°©ë¬¸í•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤!', date: '2026.01.01' }
                        ]
                    };
                },

                toggleBgm() {
                    const audio = document.getElementById('bgm-player');
                    if (this.bgmPlaying) audio.pause();
                    else audio.play();
                    this.bgmPlaying = !this.bgmPlaying;
                },

                toggleFold(section) {
                    section.isFolded = !section.isFolded;
                },

                initPetals() {
                    const canvas = document.getElementById('effect-canvas');
                    const ctx = canvas.getContext('2d');
                    let petals = [];
                    const resize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };
                    window.addEventListener('resize', resize); resize();

                    class Petal {
                        constructor() {
                            this.x = Math.random() * canvas.width;
                            this.y = -20;
                            this.size = Math.random() * 8 + 4;
                            this.vX = Math.random() * 1.5 - 0.5;
                            this.vY = Math.random() * 1.5 + 1;
                            this.angle = Math.random() * 360;
                            this.vAngle = Math.random() * 1 - 0.5;
                            this.opacity = Math.random() * 0.4 + 0.3;
                        }
                        update() {
                            this.x += this.vX; this.y += this.vY; this.angle += this.vAngle;
                            if (this.y > canvas.height) this.y = -20;
                        }
                        draw() {
                            ctx.save();
                            ctx.translate(this.x, this.y);
                            ctx.rotate(this.angle * Math.PI / 180);
                            ctx.globalAlpha = this.opacity;
                            ctx.fillStyle = '#f2aebc';
                            ctx.beginPath();
                            ctx.ellipse(0, 0, this.size, this.size / 2, 0, 0, Math.PI * 2);
                            ctx.fill();
                            ctx.restore();
                        }
                    }

                    for(let i=0; i<30; i++) petals.push(new Petal());
                    const loop = () => {
                        ctx.clearRect(0, 0, canvas.width, canvas.height);
                        petals.forEach(p => { p.update(); p.draw(); });
                        requestAnimationFrame(loop);
                    };
                    loop();
                },

                initTimer() {
                    const update = () => {
                        const now = new Date();
                        const kstNow = new Date(now.getTime() + (now.getTimezoneOffset() * 60000) + (9 * 3600000));
                        const target = new Date(this.data.weddingDate);
                        const kstTarget = new Date(target.getTime() + (target.getTimezoneOffset() * 60000) + (9 * 3600000));
                        const diff = kstTarget - kstNow;
                        const prefix = diff >= 0 ? 'D-' : 'D+';
                        const abs = Math.abs(diff);
                        const d = Math.floor(abs / 86400000);
                        const h = String(Math.floor((abs % 86400000) / 3600000)).padStart(2,'0');
                        const m = String(Math.floor((abs % 3600000) / 60000)).padStart(2,'0');
                        const s = String(Math.floor((abs % 60000) / 1000)).padStart(2,'0');
                        this.timerText = `${prefix}${d} ${h}:${m}:${s}`;
                    };
                    update(); setInterval(update, 1000);
                },

                initMap() {
                    const load = () => {
                        if (typeof kakao === 'undefined') return setTimeout(load, 200);
                        kakao.maps.load(() => {
                            const mapContainer = document.getElementById('map');
                            if (!mapContainer) return;
                            const mapOption = { center: new kakao.maps.LatLng(37.5218, 127.0374), level: 3 };
                            const map = new kakao.maps.Map(mapContainer, mapOption);
                            const geocoder = new kakao.maps.services.Geocoder();
                            geocoder.addressSearch(this.data.venue.address, (result, status) => {
                                if (status === kakao.maps.services.Status.OK) {
                                    const coords = new kakao.maps.LatLng(result[0].y, result[0].x);
                                    new kakao.maps.Marker({ map: map, position: coords });
                                    map.setCenter(coords);
                                }
                            });
                        });
                    };
                    this.$nextTick(load);
                },

                initReveal() {
                    const obs = new IntersectionObserver(entries => {
                        entries.forEach(e => { if(e.isIntersecting) e.target.classList.add('active'); });
                    }, { threshold: 0.1 });
                    this.$nextTick(() => document.querySelectorAll('.reveal').forEach(el => obs.observe(el)));
                },

                getYoutubeId() {
                    const match = this.data.youtubeLink.match(/(?:youtu\.be\/|youtube\.com\/(?:v\/|u\/\w\/|embed\/|watch\?v=))([^#\&\?]*)/);
                    return (match && match[1].length === 11) ? match[1] : '';
                },
                openYoutube() { this.showYoutube = true; },
                openGallery(img) { this.activeImg = img; this.showGalModal = true; },
                copy(txt) { navigator.clipboard.writeText(txt); alert('ê³„ì¢Œë²ˆí˜¸ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.'); },
                copyLink() { navigator.clipboard.writeText(window.location.href); alert('í´ë¦½ë³´ë“œì— ì£¼ì†Œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.'); },

                getCalTitle() { const d = new Date(this.data.weddingDate); return `${d.getFullYear()} . ${d.getMonth()+1}`; },
                getCalStartDay() { const d = new Date(this.data.weddingDate); return new Date(d.getFullYear(), d.getMonth(), 1).getDay(); },
                getCalDays() { const d = new Date(this.data.weddingDate); return new Date(d.getFullYear(), d.getMonth()+1, 0).getDate(); },
                getCalDayNum(d) { const date = new Date(this.data.weddingDate); return new Date(date.getFullYear(), date.getMonth(), d).getDay(); },
                isWeddingDay(d) { return d === new Date(this.data.weddingDate).getDate(); },

                getGroomPhones() {
                    let res = [{ label: this.data.groom.name, val: this.data.groom.phone }];
                    if(this.data.groomParents.fPhone) res.push({ label: 'ì•„ë²„ì§€ ' + this.data.groom.father, val: this.data.groomParents.fPhone });
                    if(this.data.groomParents.mPhone) res.push({ label: 'ì–´ë¨¸ë‹ˆ ' + this.data.groom.mother, val: this.data.groomParents.mPhone });
                    return res;
                },
                getBridePhones() {
                    let res = [{ label: this.data.bride.name, val: this.data.bride.phone }];
                    if(this.data.brideParents.fPhone) res.push({ label: 'ì•„ë²„ì§€ ' + this.data.bride.father, val: this.data.brideParents.fPhone });
                    if(this.data.brideParents.mPhone) res.push({ label: 'ì–´ë¨¸ë‹ˆ ' + this.data.bride.mother, val: this.data.brideParents.mPhone });
                    return res;
                },
                getGroomAccounts() {
                    let res = [{ label: this.data.groom.name, val: this.data.groom.acc, bank: this.data.groom.bank }];
                    if(this.data.groomParents.fAcc) res.push({ label: 'ì•„ë²„ì§€ ' + this.data.groom.father, val: this.data.groomParents.fAcc, bank: this.data.groomParents.fBank });
                    if(this.data.groomParents.mAcc) res.push({ label: 'ì–´ë¨¸ë‹ˆ ' + this.data.groom.mother, val: this.data.groomParents.mAcc, bank: this.data.groomParents.mBank });
                    return res;
                },
                getBrideAccounts() {
                    let res = [{ label: this.data.bride.name, val: this.data.bride.acc, bank: this.data.bride.bank }];
                    if(this.data.brideParents.fAcc) res.push({ label: 'ì•„ë²„ì§€ ' + this.data.bride.father, val: this.data.brideParents.fAcc, bank: this.data.brideParents.fBank });
                    if(this.data.brideParents.mAcc) res.push({ label: 'ì–´ë¨¸ë‹ˆ ' + this.data.bride.mother, val: this.data.brideParents.mAcc, bank: this.data.brideParents.mBank });
                    return res;
                },

                submitRsvp() {
                    if(!this.rsvpForm.name || !this.rsvpForm.phone) return alert('ì„±í•¨ê³¼ ì—°ë½ì²˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    const existing = JSON.parse(localStorage.getItem('rsvp_data') || '[]');
                    existing.push({ ...this.rsvpForm, side: this.rsvpSide, date: new Date().toLocaleString() });
                    localStorage.setItem('rsvp_data', JSON.stringify(existing));
                    alert('ì°¸ì„ ì—¬ë¶€ê°€ ì „ë‹¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    this.showRsvpModal = false;
                },

                submitGuestbook() {
                    if(!this.gbForm.name || !this.gbForm.content) return alert('ì„±í•¨ê³¼ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    this.data.guestbook.unshift({ name: this.gbForm.name, content: this.gbForm.content, date: new Date().toLocaleDateString() });
                    localStorage.setItem('wedding_v2_data', JSON.stringify(this.data));
                    this.gbForm = { name: '', content: '' };
                    this.showGuestbookModal = false;
                },

                openExternalMap(type) {
                    const urls = {
                        naver: 'https://map.naver.com/p/entry/place/21413303',
                        kakao: 'https://map.kakao.com/?itemId=17416438',
                        tmap: 'https://poi.tmobiweb.com/app/share/position?poiId=2906804'
                    };
                    window.open(urls[type]);
                }
            };
        }
    </script>
</body>
</html>
